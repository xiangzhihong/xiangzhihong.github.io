<!DOCTYPE HTML>
<html>
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no">
    <link rel="dns-prefetch" href="//t11.baidu.com">
    <!--SEO-->



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>高级聚类 | 向志洪</title>


    <link rel="alternate" href="/atom.xml" title="向志洪" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css?rev=9.12.0">


<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    <div class="hide">
    <script src="https://s4.cnzz.com/z_stat.php?id=1261768793&web_id=1262140174" language="JavaScript"></script>
    </div>
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?13764659765";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
	
	<script src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script>
    <script>AV.initialize("aj42pgqDHRSVhMknqDb3JMeg-gzGzoHsz", "qbRaoHOP9NMWPOow8PandkH3");</script>
</head></html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header">
    <div class="main-header-box">
        <a class="branding" href="/" title="">
            <img src="/img/header_logo.png" alt="Snippet 博客主题">
        </a>
        <h2 class="text-hide">Snippet主题</h2>
        <img src="/img/header_logo.png" alt="Snippet 博客主题" class="hide">
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class=""><a href="/">首页</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/前端/">前端</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/后端/">后端</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/Java/">Java</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/Python/">Python</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/Android/">Android</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/iOS/">iOS</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/React Native/">React Native</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/小程序/">小程序</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/杂谈/">杂谈</a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="高级聚类">
            
            高级聚类
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <span>Python</span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            Python
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2016/01/25</span>
    </span>
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>684</strong>天之前发表，文中内容可能已经过时。
            </p>
            
    </div>
    
    <div class="post-body">
        <h5 id="FuzzyKmeans"><a href="#FuzzyKmeans" class="headerlink" title="FuzzyKmeans"></a>FuzzyKmeans</h5><p><a href="http://blog.csdn.net/zhaoxinfan/article/details/19123309" target="_blank" rel="external">传送门</a></p>
<p>在对数据进行聚类时，最常用的方法应该是kmeans，但是kmean只能保证每一条待聚类的数据划分到一个类别，针对一条数据可以被划分到多个类别的情况无法处理。为此，人们提出了FuzzyKmeans聚类方法，该方法衡量的是每一条数据属于某个类别的概率，既然是概率就不再是非1即0的情况，这样就能保证一条数据可以被划分到多个类别。</p>
<p>对应FuzzyKmeans的聚类过程如下：<br><img src="http://img.blog.csdn.net/20140212164330921" alt=""></p>
<p>其中dij这个参数衡量的是该条数据i到类别j中心点的距离，uij就是数据i属于类别j的概率。</p>
<p>求得概率之后，需要更新某个类别的中心点，这时就按照(4)式更新，也就是用属于该类的概率与数据原先的值加以计算</p>
<p>至于结束条件一种是达到设定的迭代次数，一种是满足第四步的条件，即两个类别的中心点距离小于一个值。</p>
<p>最重要的应该是m值的选择，当每条数据距离各个类别中心点距离比较接近时，建议1/(m-1)值较大，因为这样在指数运算后距离就能有较大差异了，此时m接近于1. 如果距离本来就有很大差异，1/(m-1)就可以取值小一些，一般来说m取1.5，这样就足够了。</p>
<p>最后要注意迭代次数不宜过多，一般两次足够，因为考虑的是概率，如果迭代次数过多，中心点偏移较大，很可能得到数据到各个类别的概率都相差不大。</p>
<p>下面用JAVA实现的FuzzyKmeans，每一条数据都是一个200维的向量，使用时可以指定初始中心点，中心点的向量需要从待聚类数据中查找得到。</p>
<p>首先是处理输入的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> kmeans;  </div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;  </div><div class="line"><span class="keyword">import</span> java.io.File;  </div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;  </div><div class="line"><span class="keyword">import</span> java.io.IOException;  </div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;  </div><div class="line"><span class="keyword">import</span> java.util.ArrayList;  </div><div class="line"><span class="keyword">import</span> java.util.HashMap;  </div><div class="line"><span class="keyword">import</span> java.util.List;  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Word2VEC</span> </span>&#123;  </div><div class="line">      </div><div class="line">    <span class="keyword">private</span> HashMap&lt;String, <span class="keyword">double</span>[]&gt; wordMap = <span class="keyword">new</span> HashMap&lt;String, <span class="keyword">double</span>[]&gt;();  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadVectorFile</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException </span>&#123;  </div><div class="line">        BufferedReader br = <span class="keyword">null</span>;  </div><div class="line">        <span class="keyword">double</span> len = <span class="number">0</span>;  </div><div class="line">        <span class="keyword">double</span> vector = <span class="number">0</span>;  </div><div class="line">        <span class="keyword">int</span> size=<span class="number">0</span>;  </div><div class="line">        <span class="keyword">try</span> &#123;  </div><div class="line">            File f = <span class="keyword">new</span> File(path);  </div><div class="line">            br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(f), <span class="string">"UTF-8"</span>));  </div><div class="line">            String word;  </div><div class="line">            String line=<span class="string">""</span>;  </div><div class="line">            String[] outline=<span class="keyword">new</span> String[<span class="number">210</span>];  </div><div class="line">            <span class="keyword">double</span>[] vectors = <span class="keyword">null</span>;  </div><div class="line">            <span class="keyword">int</span> count=<span class="number">0</span>;  </div><div class="line">            <span class="keyword">while</span>((line=br.readLine())!=<span class="keyword">null</span>)&#123;  </div><div class="line">                <span class="keyword">if</span>(count%<span class="number">100000</span>==<span class="number">0</span>)&#123;  </div><div class="line">                    System.out.println(<span class="string">"read: "</span>+count);  </div><div class="line">                &#125;  </div><div class="line">                count++;  </div><div class="line">                outline=line.split(<span class="string">","</span>);  </div><div class="line">                size=outline.length-<span class="number">1</span>;  </div><div class="line">                word = outline[<span class="number">0</span>];  </div><div class="line">                vectors = <span class="keyword">new</span> <span class="keyword">double</span>[size];  </div><div class="line">                len = <span class="number">0</span>;  </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++) &#123;  </div><div class="line">                    vector = Float.parseFloat(outline[j+<span class="number">1</span>]);  </div><div class="line">                    len += vector * vector;  </div><div class="line">                    vectors[j] = (<span class="keyword">double</span>) vector;  </div><div class="line">                &#125;  </div><div class="line">                len = Math.sqrt(len);  </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; size; j++) &#123;  </div><div class="line">                    vectors[j] /= len;  </div><div class="line">                &#125;  </div><div class="line">                wordMap.put(word, vectors);  </div><div class="line">            &#125;  </div><div class="line">        &#125;   </div><div class="line">        <span class="keyword">finally</span> &#123;  </div><div class="line">            System.out.println(<span class="string">"total word: "</span>+wordMap.size()+<span class="string">" vector dimensions: "</span>+size);  </div><div class="line">            br.close();  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="keyword">public</span> HashMap&lt;String, <span class="keyword">double</span>[]&gt; getWordMap() &#123;  </div><div class="line">        <span class="keyword">return</span> wordMap;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    <span class="comment">//calculate how many center point in the samples  </span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">loadPointFile</span><span class="params">(String point_path)</span> <span class="keyword">throws</span> IOException</span>&#123;  </div><div class="line">        File f = <span class="keyword">new</span> File(point_path);  </div><div class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(f), <span class="string">"UTF-8"</span>));  </div><div class="line">        String line=<span class="string">""</span>;  </div><div class="line">        List&lt;String&gt; center=<span class="keyword">new</span> ArrayList&lt;String&gt;();  </div><div class="line">        <span class="keyword">while</span>((line=br.readLine())!=<span class="keyword">null</span>)&#123;  </div><div class="line">            <span class="keyword">if</span>(wordMap.containsKey(line))&#123;  </div><div class="line">                center.add(line);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        br.close();  </div><div class="line">        <span class="keyword">return</span> center;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后是聚类的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> kmeans;  </div><div class="line"><span class="keyword">import</span> java.io.BufferedReader;  </div><div class="line"><span class="keyword">import</span> java.io.BufferedWriter;  </div><div class="line"><span class="keyword">import</span> java.io.File;  </div><div class="line"><span class="keyword">import</span> java.io.FileInputStream;  </div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;  </div><div class="line"><span class="keyword">import</span> java.io.FileOutputStream;  </div><div class="line"><span class="keyword">import</span> java.io.IOException;  </div><div class="line"><span class="keyword">import</span> java.io.InputStreamReader;  </div><div class="line"><span class="keyword">import</span> java.io.OutputStreamWriter;  </div><div class="line"><span class="keyword">import</span> java.util.ArrayList;  </div><div class="line"><span class="keyword">import</span> java.util.Collections;  </div><div class="line"><span class="keyword">import</span> java.util.HashMap;  </div><div class="line"><span class="keyword">import</span> java.util.Iterator;  </div><div class="line"><span class="keyword">import</span> java.util.List;  </div><div class="line"><span class="keyword">import</span> java.util.Map;  </div><div class="line"><span class="keyword">import</span> java.util.Map.Entry;  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> org.apache.commons.cli.CommandLine;  </div><div class="line"><span class="keyword">import</span> org.apache.commons.cli.CommandLineParser;  </div><div class="line"><span class="keyword">import</span> org.apache.commons.cli.HelpFormatter;  </div><div class="line"><span class="keyword">import</span> org.apache.commons.cli.Options;  </div><div class="line"><span class="keyword">import</span> org.apache.commons.cli.ParseException;  </div><div class="line"><span class="keyword">import</span> org.apache.commons.cli.PosixParser;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FuzzyKmeans</span> </span>&#123;  </div><div class="line">        <span class="keyword">private</span> HashMap&lt;String, <span class="keyword">double</span>[]&gt; wordMap = <span class="keyword">null</span>;  </div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> iter;  </div><div class="line">        <span class="keyword">private</span> Classes[] cArray = <span class="keyword">null</span>;  </div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Integer,String&gt; wordcenter=<span class="keyword">new</span> HashMap&lt;Integer,String&gt;();  </div><div class="line">          </div><div class="line">        <span class="comment">//total 659624 words each is a 200 vector  </span></div><div class="line">        <span class="comment">//args[0] is the word vectors csv file  </span></div><div class="line">        <span class="comment">//args[1] is the output file   </span></div><div class="line">        <span class="comment">//args[2] is the cluster number  </span></div><div class="line">        <span class="comment">//args[3] is the iterator number  </span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ParseException </span>&#123;  </div><div class="line">              </div><div class="line">            String source_path;  </div><div class="line">            String output_path;  </div><div class="line">            <span class="keyword">int</span> cluster_num = <span class="number">10</span>;  </div><div class="line">            <span class="keyword">int</span> iterator_num = <span class="number">10</span>;  </div><div class="line">            <span class="keyword">double</span> m=<span class="number">1.5</span>;  </div><div class="line">      </div><div class="line">              </div><div class="line">            String point_path = <span class="keyword">null</span>;  </div><div class="line">              </div><div class="line">             Options options = <span class="keyword">new</span> Options();    </div><div class="line">             options.addOption(<span class="string">"h"</span>, <span class="keyword">false</span>, <span class="string">"help"</span>); <span class="comment">//参数不可用  </span></div><div class="line">             options.addOption(<span class="string">"i"</span>, <span class="keyword">true</span>, <span class="string">"input file path"</span>); <span class="comment">//参数可用       </span></div><div class="line">             options.addOption(<span class="string">"o"</span>, <span class="keyword">true</span>, <span class="string">"output file path"</span>); <span class="comment">//参数可用   </span></div><div class="line">             options.addOption(<span class="string">"c"</span>, <span class="keyword">true</span>, <span class="string">"cluster number, default 10"</span>); <span class="comment">//参数可用   </span></div><div class="line">             options.addOption(<span class="string">"x"</span>, <span class="keyword">true</span>, <span class="string">"iterator number, default 10"</span>); <span class="comment">//参数可用   </span></div><div class="line">             options.addOption(<span class="string">"p"</span>, <span class="keyword">true</span>, <span class="string">"the center point"</span>); <span class="comment">//参数可用  </span></div><div class="line">             options.addOption(<span class="string">"m"</span>, <span class="keyword">true</span>, <span class="string">"the parameter for fuzzy kmeans"</span>); <span class="comment">//参数可用  </span></div><div class="line">               </div><div class="line">             CommandLineParser parser = <span class="keyword">new</span> PosixParser();    </div><div class="line">             CommandLine cmd = parser.parse(options, args);    </div><div class="line">         </div><div class="line">             <span class="keyword">if</span> (cmd.hasOption(<span class="string">"i"</span>))    </div><div class="line">             &#123;    </div><div class="line">                source_path = cmd.getOptionValue(<span class="string">"i"</span>);    </div><div class="line">             &#125;<span class="keyword">else</span>&#123;  </div><div class="line">                 HelpFormatter formatter = <span class="keyword">new</span> HelpFormatter();    </div><div class="line">                 formatter.printHelp( <span class="string">"help"</span>, options );   </div><div class="line">                 <span class="keyword">return</span>;  </div><div class="line">             &#125;  </div><div class="line">               </div><div class="line">             <span class="keyword">if</span> (cmd.hasOption(<span class="string">"o"</span>))    </div><div class="line">             &#123;    </div><div class="line">                 output_path = cmd.getOptionValue(<span class="string">"o"</span>);    </div><div class="line">             &#125;<span class="keyword">else</span>&#123;  </div><div class="line">                 HelpFormatter formatter = <span class="keyword">new</span> HelpFormatter();    </div><div class="line">                 formatter.printHelp( <span class="string">"help"</span>, options );   </div><div class="line">                 <span class="keyword">return</span>;  </div><div class="line">             &#125;  </div><div class="line">         </div><div class="line">             <span class="keyword">if</span> (cmd.hasOption(<span class="string">"c"</span>))    </div><div class="line">             &#123;    </div><div class="line">                 cluster_num = Integer.parseInt(cmd.getOptionValue(<span class="string">"c"</span>));    </div><div class="line">             &#125;  </div><div class="line">             <span class="keyword">if</span> (cmd.hasOption(<span class="string">"m"</span>))    </div><div class="line">             &#123;    </div><div class="line">                 m = Double.parseDouble(cmd.getOptionValue(<span class="string">"m"</span>));    </div><div class="line">             &#125;  </div><div class="line">               </div><div class="line">             <span class="keyword">if</span> (cmd.hasOption(<span class="string">"x"</span>))    </div><div class="line">             &#123;    </div><div class="line">                 iterator_num = Integer.parseInt(cmd.getOptionValue(<span class="string">"x"</span>));    </div><div class="line">             &#125;  </div><div class="line">             <span class="keyword">if</span> (cmd.hasOption(<span class="string">"p"</span>))    </div><div class="line">             &#123;    </div><div class="line">                 point_path = cmd.getOptionValue(<span class="string">"p"</span>);    </div><div class="line">             &#125;  </div><div class="line">               </div><div class="line">             <span class="keyword">if</span> (cmd.hasOption(<span class="string">"h"</span>))    </div><div class="line">             &#123;    </div><div class="line">                 HelpFormatter formatter = <span class="keyword">new</span> HelpFormatter();    </div><div class="line">                 formatter.printHelp( <span class="string">"help"</span>, options );   </div><div class="line">             &#125;  </div><div class="line">               </div><div class="line">            Word2VEC vec = <span class="keyword">new</span> Word2VEC();  </div><div class="line">            vec.loadVectorFile(source_path);  </div><div class="line">            System.out.println(<span class="string">"load data ok!"</span>);  </div><div class="line">              </div><div class="line">              </div><div class="line">            List&lt;String&gt; center=<span class="keyword">new</span> ArrayList&lt;String&gt;();  </div><div class="line">            <span class="keyword">if</span>(point_path!=<span class="keyword">null</span>)&#123;  </div><div class="line">                center=vec.loadPointFile(point_path);  </div><div class="line">                <span class="keyword">if</span>(cluster_num&lt;center.size())&#123;  </div><div class="line">                    cluster_num=center.size();  </div><div class="line">                &#125;  </div><div class="line">                  </div><div class="line">            &#125;  </div><div class="line">              </div><div class="line">              </div><div class="line">            FuzzyKmeans fuzzyKmeans = <span class="keyword">new</span> FuzzyKmeans(vec.getWordMap(), cluster_num,iterator_num);  </div><div class="line">            Classes[] explain = fuzzyKmeans.explain(point_path,m,center);  </div><div class="line">              </div><div class="line">            File fw = <span class="keyword">new</span> File(output_path);  </div><div class="line">            BufferedWriter bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(fw), <span class="string">"UTF-8"</span>));  </div><div class="line">              </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; explain.length; i++) &#123;  </div><div class="line">                List&lt;Entry&lt;String, Double&gt;&gt; result=explain[i].getMember();  </div><div class="line">                StringBuffer buf = <span class="keyword">new</span> StringBuffer();  </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; result.size(); j++) &#123;  </div><div class="line">                    buf.append(i+<span class="string">"\t"</span>+wordcenter.get(i)+<span class="string">"\t"</span>+result.get(j).getKey()+<span class="string">"\t"</span>+String.format(<span class="string">"%.6f"</span>, result.get(j).getValue())+<span class="string">"\n"</span>);  </div><div class="line">                &#125;  </div><div class="line">                bw.write(buf.toString());  </div><div class="line">                bw.flush();  </div><div class="line">            &#125;  </div><div class="line">            bw.close();  </div><div class="line">              </div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;wordcenter.size();i++)&#123;  </div><div class="line">                System.out.println(i+<span class="string">"\t"</span>+wordcenter.get(i));  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FuzzyKmeans</span><span class="params">(HashMap&lt;String, <span class="keyword">double</span>[]&gt; wordMap, <span class="keyword">int</span> clcn, <span class="keyword">int</span> iter)</span> </span>&#123;  </div><div class="line">            <span class="keyword">this</span>.wordMap = wordMap;  </div><div class="line">            <span class="keyword">this</span>.iter = iter;  </div><div class="line">            cArray = <span class="keyword">new</span> Classes[clcn];  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        <span class="keyword">public</span> Classes[] explain(String point_path,<span class="keyword">double</span> m,List&lt;String&gt; center) <span class="keyword">throws</span> IOException, FileNotFoundException &#123;  </div><div class="line">            Iterator&lt;Entry&lt;String, <span class="keyword">double</span>[]&gt;&gt; iterator = wordMap.entrySet().iterator();  </div><div class="line">            <span class="comment">//cluster number is the same as the center point number  </span></div><div class="line">            <span class="keyword">if</span>(cArray.length==center.size())&#123;  </div><div class="line">                String word=<span class="string">""</span>;  </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cArray.length; i++) &#123;  </div><div class="line">                    word=center.get(i);  </div><div class="line">                    cArray[i] = <span class="keyword">new</span> Classes(i, wordMap.get(word));  </div><div class="line">                    wordcenter.put(i, word);  </div><div class="line">                    System.out.println(<span class="keyword">new</span> String(word.getBytes(<span class="string">"UTF-8"</span>)));  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">              </div><div class="line">            <span class="keyword">else</span>&#123;  </div><div class="line">                <span class="keyword">if</span>(point_path==<span class="keyword">null</span>)&#123;  </div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cArray.length; i++) &#123;  </div><div class="line">                        Entry&lt;String, <span class="keyword">double</span>[]&gt; next = iterator.next();  </div><div class="line">                        cArray[i] = <span class="keyword">new</span> Classes(i, next.getValue());  </div><div class="line">                    &#125;  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">else</span>&#123;  </div><div class="line">                    String word=<span class="string">""</span>;  </div><div class="line">                    File f = <span class="keyword">new</span> File(point_path);  </div><div class="line">                    BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(f), <span class="string">"UTF-8"</span>));  </div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cArray.length; i++) &#123;  </div><div class="line">                        word=br.readLine();  </div><div class="line">                        <span class="keyword">if</span>(wordMap.containsKey(word))&#123;  </div><div class="line">                            cArray[i] = <span class="keyword">new</span> Classes(i, wordMap.get(word));  </div><div class="line">                            wordcenter.put(i, word);  </div><div class="line">                            System.out.println(<span class="keyword">new</span> String(word.getBytes(<span class="string">"UTF-8"</span>)));  </div><div class="line">                        &#125;  </div><div class="line">                        <span class="keyword">else</span>&#123;  </div><div class="line">                            Entry&lt;String, <span class="keyword">double</span>[]&gt; next = iterator.next();  </div><div class="line">                            cArray[i] = <span class="keyword">new</span> Classes(i, next.getValue());  </div><div class="line">                            wordcenter.put(i, next.getKey());  </div><div class="line">                        &#125;  </div><div class="line">                    &#125;  </div><div class="line">                    br.close();  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">              </div><div class="line">              </div><div class="line">              </div><div class="line">            iterator = wordMap.entrySet().iterator();  </div><div class="line">            HashMap&lt;Integer,String&gt; num_wordmap=<span class="keyword">new</span> HashMap&lt;Integer,String&gt;();  </div><div class="line">            HashMap&lt;Integer,<span class="keyword">double</span>[]&gt; num_vecmap=<span class="keyword">new</span> HashMap&lt;Integer,<span class="keyword">double</span>[]&gt;();  </div><div class="line">            <span class="comment">//put word to the map  </span></div><div class="line">            <span class="keyword">int</span> count=<span class="number">0</span>;  </div><div class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;  </div><div class="line">                Entry&lt;String, <span class="keyword">double</span>[]&gt; next = iterator.next();  </div><div class="line">                num_wordmap.put(count, next.getKey());  </div><div class="line">                num_vecmap.put(count, next.getValue());  </div><div class="line">                count++;  </div><div class="line">            &#125;  </div><div class="line">              </div><div class="line">              </div><div class="line">            <span class="comment">//begin iterator step  </span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; iter; i++) &#123;   </div><div class="line">                <span class="keyword">for</span> (Classes classes : cArray) &#123;  </div><div class="line">                    classes.clean();  </div><div class="line">                &#125;  </div><div class="line">                  </div><div class="line">                <span class="keyword">double</span> u[][]=<span class="keyword">new</span> <span class="keyword">double</span>[cArray.length][count];  </div><div class="line">                  </div><div class="line">                <span class="keyword">int</span> cnt = <span class="number">0</span>;  </div><div class="line">                <span class="keyword">int</span> num=<span class="number">0</span>;  </div><div class="line">                  </div><div class="line">                <span class="keyword">while</span> (num&lt;count) &#123;  </div><div class="line">                    <span class="keyword">if</span>(cnt % <span class="number">10000</span> ==<span class="number">0</span>)  </div><div class="line">                    &#123;  </div><div class="line">                        System.out.println(<span class="string">"Iter: "</span>+i+<span class="string">"\tword:"</span>+(cnt));  </div><div class="line">                    &#125;  </div><div class="line">                      </div><div class="line">                    <span class="keyword">double</span> tempScore;  </div><div class="line">                    <span class="keyword">double</span> d_sum=<span class="number">0</span>;  </div><div class="line">                    <span class="keyword">double</span> temp_sum=<span class="number">0</span>;  </div><div class="line">                    <span class="keyword">int</span> newid=<span class="number">0</span>;  </div><div class="line">                    <span class="keyword">int</span> flag=<span class="number">0</span>;  </div><div class="line">                      </div><div class="line">                    <span class="comment">//calculate the total distances  </span></div><div class="line">                    <span class="keyword">for</span> (Classes classes : cArray) &#123;  </div><div class="line">                         tempScore = classes.distance(num_vecmap.get(num));  </div><div class="line">                         <span class="keyword">if</span>(tempScore==<span class="number">0.0</span>)&#123;  </div><div class="line">                             flag=<span class="number">1</span>;  </div><div class="line">                             newid=classes.id;  </div><div class="line">                             <span class="keyword">break</span>;  </div><div class="line">                         &#125;  </div><div class="line">                         temp_sum=Math.pow(<span class="number">1</span>/tempScore, <span class="number">1</span>/(m-<span class="number">1</span>));  </div><div class="line">                         d_sum+=temp_sum;  </div><div class="line">                    &#125;  </div><div class="line">                    <span class="keyword">if</span>(flag==<span class="number">1</span>)&#123;  </div><div class="line">                         <span class="keyword">for</span> (Classes classes : cArray) &#123;  </div><div class="line">                             u[classes.id][num]=<span class="number">0</span>;  </div><div class="line">                             cArray[classes.id].putValue(num_wordmap.get(num), <span class="number">0</span>);  </div><div class="line">                         &#125;  </div><div class="line">                         u[newid][num]=<span class="number">1</span>;  </div><div class="line">                         cArray[newid].putValue(num_wordmap.get(num), <span class="number">1</span>);  </div><div class="line">                          </div><div class="line">                    &#125;  </div><div class="line">                    <span class="keyword">else</span>&#123;  </div><div class="line">                        <span class="comment">//cArray is the cluster center point  </span></div><div class="line">                        <span class="keyword">for</span> (Classes classes : cArray) &#123;  </div><div class="line">                            <span class="comment">//calculate the distance between the point and the center  </span></div><div class="line">                            tempScore = classes.distance(num_vecmap.get(num));  </div><div class="line">                            u[classes.id][num]=<span class="number">1</span>/(Math.pow(tempScore,<span class="number">1</span>/(m-<span class="number">1</span>))*d_sum);  </div><div class="line"><span class="comment">//                          System.out.println(num+" to "+classes.id+" distances:" +tempScore);  </span></div><div class="line">                            <span class="comment">//put the num and its probability  </span></div><div class="line">                            cArray[classes.id].putValue(num_wordmap.get(num), u[classes.id][num]);  </div><div class="line">                        &#125;  </div><div class="line">                    &#125;  </div><div class="line">                    cnt++;  </div><div class="line">                    num++;  </div><div class="line">                      </div><div class="line">                      </div><div class="line">                  </div><div class="line">                &#125;  </div><div class="line">                System.out.println(<span class="string">"Iter:"</span>+i+<span class="string">"\tfinished\tword:"</span>+(cnt));  </div><div class="line">                <span class="keyword">for</span> (Classes classes : cArray) &#123;  </div><div class="line">                    classes.updateCenter(num_vecmap,u,count,m);    </div><div class="line">                &#125;  </div><div class="line">                System.out.println(<span class="string">"iter "</span> + i + <span class="string">" ok!"</span>);  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">return</span> cArray;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">          </div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Classes</span> </span>&#123;  </div><div class="line">            <span class="keyword">private</span> <span class="keyword">int</span> id;  </div><div class="line">            <span class="keyword">private</span> <span class="keyword">double</span>[] center;  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="title">Classes</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">double</span>[] center)</span> </span>&#123;  </div><div class="line">                <span class="keyword">this</span>.id = id;  </div><div class="line">                <span class="keyword">this</span>.center = center.clone();  </div><div class="line">            &#125;  </div><div class="line">            Map&lt;String, Double&gt; values = <span class="keyword">new</span> HashMap&lt;String,Double&gt;();  </div><div class="line">            <span class="comment">//calculate the distance between point and center  </span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">distance</span><span class="params">(<span class="keyword">double</span>[] value)</span> </span>&#123;  </div><div class="line">                <span class="keyword">double</span> sum = <span class="number">0</span>;  </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;  </div><div class="line">                    sum += (center[i] - value[i])*(center[i] - value[i]) ;  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">return</span> sum ;  </div><div class="line">            &#125;  </div><div class="line">              </div><div class="line">            <span class="comment">//put word and its probability  </span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putValue</span><span class="params">(String word, <span class="keyword">double</span> score)</span> </span>&#123;  </div><div class="line">                values.put(word, score);  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCenter</span><span class="params">(HashMap&lt;Integer, <span class="keyword">double</span>[]&gt; num_vecmap,<span class="keyword">double</span>[][] u,<span class="keyword">int</span> count,<span class="keyword">double</span> m)</span> </span>&#123;  </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; center.length; i++) &#123;  </div><div class="line">                    center[i] = <span class="number">0</span>;  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">double</span>[] value = <span class="keyword">null</span>;  </div><div class="line">                  </div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;count;j++)&#123;  </div><div class="line">                    value = num_vecmap.get(j);  </div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;  </div><div class="line">                            center[i] +=Math.pow(u[id][j],m) *value[i];  </div><div class="line">                    &#125;  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">double</span> sum=<span class="number">0</span>;  </div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;count;j++)&#123;  </div><div class="line">                    sum+=Math.pow(u[id][j],m);  </div><div class="line">                &#125;  </div><div class="line">                  </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; center.length; i++) &#123;  </div><div class="line">                    center[i] = center[i] / sum;  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clean</span><span class="params">()</span> </span>&#123;  </div><div class="line">                values.clear();  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">  </div><div class="line">              </div><div class="line">            <span class="keyword">public</span> List&lt;Entry&lt;String, Double&gt;&gt; getMember() &#123;  </div><div class="line">                List&lt;Map.Entry&lt;String, Double&gt;&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;Map.Entry&lt;String, Double&gt;&gt;(  </div><div class="line">                    values.entrySet());  </div><div class="line">                <span class="keyword">int</span> count=arrayList.size();  </div><div class="line">                <span class="keyword">if</span>(count&lt;=<span class="number">0</span>)&#123;  </div><div class="line">                    <span class="keyword">return</span> Collections.emptyList() ;  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">return</span> arrayList;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#####BIRCH算法</p>
<p>######算法概念<br><a href="http://blog.csdn.net/qll125596718/article/details/6895291" target="_blank" rel="external">传送</a><br> BIRCH（Balanced Iterative Reducing and Clustering Using Hierarchies）全称是：利用层次方法的平衡迭代规约和聚类。BIRCH算法是1996年由Tian Zhang提出来的，参考文献1。首先，BIRCH是一种聚类算法，它最大的特点是能利用有限的内存资源完成对大数据集的高质量的聚类，同时通过单遍扫描数据集能最小化I/O代价。</p>
<p>   首先解释一下什么是聚类，从统计学的观点来看，聚类就是给定一个包含N个数据点的数据集和一个距离度量函数F（例如计算簇内每两个数据点之间的平均距离的函数），要求将这个数据集划分为K个簇（或者不给出数量K，由算法自动发现最佳的簇数量），最后的结果是找到一种对于数据集的最佳划分，使得距离度量函数F的值最小。从机器学习的角度来看，聚类是一种非监督的学习算法，通过将数据集聚成n个簇，使得簇内点之间距离最小化，簇之间的距离最大化。</p>
<p>  BIRCH算法特点：</p>
<ul>
<li><p>BIRCH试图利用可用的资源来生成最好的聚类结果，给定有限的主存，一个重要的考虑是最小化I/O时间。</p>
</li>
<li><p>BIRCH采用了一种多阶段聚类技术：数据集的单边扫描产生了一个基本的聚类，一或多遍的额外扫描可以进一步改进聚类质量。</p>
</li>
<li><p>BIRCH是一种增量的聚类方法，因为它对每一个数据点的聚类的决策都是基于当前已经处理过的数据点，而不是基于全局的数据点。</p>
</li>
<li><p>如果簇不是球形的，BIRCH不能很好的工作，因为它用了半径或直径的概念来控制聚类的边界。</p>
<p>BIRCH算法中引入了两个概念：聚类特征和聚类特征树，以下分别介绍。</p>
</li>
</ul>
<p>######1.1 聚类特征（CF）<br>CF是BIRCH增量聚类算法的核心，CF树中得节点都是由CF组成，一个CF是一个三元组，这个三元组就代表了簇的所有信息。给定N个d维的数据点{x1,x2,….,xn}，CF定义如下：</p>
<p>CF=（N，LS，SS）</p>
<p> 其中，N是子类中节点的数目，LS是N个节点的线性和，SS是N个节点的平方和。</p>
<p>  CF有个特性，即可以求和，具体说明如下：CF1=（n1,LS1,SS1），CF2=（n2,LS2,SS2），则CF1+CF2=（n1+n2, LS1+LS2, SS1+SS2）。</p>
<p>  例如：</p>
<p>  假设簇C1中有三个数据点：（2,3），（4,5），（5,6），则CF1={3，（2+4+5,3+5+6），（2^2+4^2+5^2,3^2+5^2+6^2）}={3，（11,14），（45,70）}，同样的，簇C2的CF2={4，（40,42），（100,101）}，那么，由簇C1和簇C2合并而来的簇C3的聚类特征CF3计算如下：</p>
<p>CF3={3+4,（11+40,14+42），（45+100,70+101）}={7，（51,56），（145,171）}</p>
<p>  另外在介绍两个概念：簇的质心和簇的半径。假如一个簇中包含n个数据点：{Xi}，i=1,2,3…n.，则质心C和半径R计算公式如下：</p>
<p>C=(X1+X2+…+Xn)/n，（这里X1+X2+…+Xn是向量加）</p>
<p>R=(|X1-C|^2+|X2-C|^2+…+|Xn-C|^2)/n</p>
<p>  其中，簇半径表示簇中所有点到簇质心的平均距离。CF中存储的是簇中所有数据点的特性的统计和，所以当我们把一个数据点加入某个簇的时候，那么这个数据点的详细特征，例如属性值，就丢失了，由于这个特征，BIRCH聚类可以在很大程度上对数据集进行压缩。</p>
<p>######1.2 聚类特征树（CF tree）<br>CF tree的结构类似于一棵B-树，它有两个参数：内部节点平衡因子B，叶节点平衡因子L，簇半径阈值T。树中每个节点最多包含B个孩子节点，记为（CFi，CHILDi），1&lt;=i&lt;=B，CFi是这个节点中的第i个聚类特征，CHILDi指向节点的第i个孩子节点，对应于这个节点的第i个聚类特征。例如，一棵高度为3，B为6，L为5的一棵CF树的例子如图所示：</p>
<p><img src="http://hi.csdn.net/attachment/201110/22/0_1319248203u2NP.gif" alt=""></p>
<p>棵CF树是一个数据集的压缩表示，叶子节点的每一个输入都代表一个簇C，簇C中包含若干个数据点，并且原始数据集中越密集的区域，簇C中包含的数据点越多，越稀疏的区域，簇C中包含的数据点越少，簇C的半径小于等于T。随着数据点的加入，CF树被动态的构建，插入过程有点类似于B-树。加入算法表示如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(1)从根节点开始，自上而下选择最近的孩子节点  </div><div class="line">(2)到达叶子节点后，检查最近的元组CFi能否吸收此数据点  </div><div class="line">    是，更新CF值  </div><div class="line">    否，是否可以添加一个新的元组  </div><div class="line">        是，添加一个新的元组  </div><div class="line">        否则，分裂最远的一对元组，作为种子，按最近距离重新分配其它元组  </div><div class="line">(3)更新每个非叶节点的CF信息，如果分裂节点，在父节点中插入新的元组，检查分裂，直到root</div></pre></td></tr></table></figure>
<p> 计算节点之间的距离函数有多种选择，常见的有欧几里得距离函数和曼哈顿距离函数，具体公式如下：</p>
<p> <img src="http://hi.csdn.net/attachment/201110/22/0_1319248900aRfD.gif" alt=""></p>
<p>构建CF树的过程中，一个重要的参数是簇半径阈值T，因为它决定了CF tree的规模，从而让CF tree适应当前内存的大小。如果T太小，那么簇的数量将会非常的大，从而导致树节点数量也会增大，这样可能会导致所有数据点还没有扫描完之前内存就不够用了。</p>
<p>######2.算法流程</p>
<p>  BIRCH算法流程如下图所示：<br><img src="http://hi.csdn.net/attachment/201110/22/0_131924943946It.gif" alt=""></p>
<p>整个算法的实现分为四个阶段：</p>
<p>（1）扫描所有数据，建立初始化的CF树，把稠密数据分成簇，稀疏数据作为孤立点对待<br>（2）这个阶段是可选的，阶段3的全局或半全局聚类算法有着输入范围的要求，以达到速度与质量的要求，所以此阶段在阶段1的基础上，建立一个更小的CF树<br>（3）补救由于输入顺序和页面大小带来的分裂，使用全局/半全局算法对全部叶节点进行聚类<br>（4）这个阶段也是可选的，把阶段3的中心点作为种子，将数据点重新分配到最近的种子上，保证重复数据分到同一个簇中，同时添加簇标签</p>
<p>######3.算法实现</p>
<p> BIRCH算法的发明者于1996年完成了BIRCH算法的实现，是用c++语言实现的，已在solaris下编译通过。</p>
<p> 另外算法的实现也可参考：<a href="http://blog.sina.com.cn/s/blog_6e85bf420100om1i.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_6e85bf420100om1i.html</a></p>
<p>参考文献：</p>
<p>1.BIRCH:An Efficient Data Clustering Method for Very Large Databases</p>
<p>######4. 源码解读<br><a href="http://blog.sina.com.cn/s/blog_6e85bf420100om1i.html" target="_blank" rel="external">传送</a></p>
<p>Birch算法全称是利用层次方法的平衡迭代约减和聚类(Balanced Iterative Reducing and Clustering Using Hierarchis)。该算法的优点是：第一，只需要一次访问数据库，速度快。第二，相似数据在很大程度上得到压缩，节省了存储空间。第三，不需要大量递归运算。一个聚类有了这三个优点，不优秀都难了。它是Wisconsin-Madison大学Tian Zhang博士于1996年提出的聚类算法，采用B-树的思想实现（有点遗憾，要是这个算法也是韩佳炜老师发明的就好啦）。</p>
<p>   Birch算法虽然采用B-树实现但是它又不是一个完全的B-树，因为第一，它的所有元素全部保存在叶子节点中，第二，在一个BTNode中的关键字间并没有大小关系，第三，当一个BTNode中的关键字个数大于指定数时，不需要将第(M+1)/2个关键字移到上一层节点中去，而是之间分裂成两个BTNode，再在上层中对应的BTNode中加个关键字。现在假定读者知道B-树的原理。先说明几个结构体：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//维信息，相同值会合并起来</span></div><div class="line"><span class="comment">//要按data排序，方便后面计算距离</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">AttNode</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//值</span></div><div class="line"> <span class="built_in">string</span> data;</div><div class="line"> <span class="comment">//具有该值的记录数目</span></div><div class="line"> <span class="keyword">unsigned</span> <span class="keyword">int</span> count;</div><div class="line"> <span class="comment">//该维上下一个不同取值</span></div><div class="line"> AttNode *next; </div><div class="line">&#125;*AttTree;</div><div class="line"></div><div class="line"><span class="comment">//记录信息，也即是簇信息</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CFNode</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//记录条数</span></div><div class="line"> <span class="keyword">unsigned</span> <span class="keyword">int</span> count;</div><div class="line"> <span class="comment">//属性数组</span></div><div class="line"> <span class="comment">//每个AttNode指针带头结点，方便合并两个CFNode</span></div><div class="line"> AttNode *atts[attNum];</div><div class="line">&#125;*CFTree;</div><div class="line"></div><div class="line"><span class="comment">//B-树</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//已有CF数目</span></div><div class="line"> <span class="keyword">int</span> keyNum;</div><div class="line"> <span class="comment">//0号单元未用</span></div><div class="line">    <span class="comment">//要是模仿B-树的话，应该是M+1，但是为了方便分裂就变成M+2了</span></div><div class="line"> <span class="comment">//注意keys的第1位和ptr的0位对应，keys的第2位和ptr的1位对应，以此类推</span></div><div class="line"> CFTree keys[M+<span class="number">2</span>];</div><div class="line"> BTNode *parent;</div><div class="line"> BTNode *ptr[M+<span class="number">2</span>];</div><div class="line">&#125;*BTree;</div><div class="line"><span class="comment">//叶子结构体，用于将B-树的叶子节点连起来</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BLeafNode</span></span></div><div class="line">&#123;</div><div class="line"> BTree leaf;</div><div class="line"> BLeafNode *next;</div><div class="line">&#125;*BLeafTree;</div><div class="line"><span class="comment">//beginLeaft保存起始叶子节点的位置</span></div><div class="line">BLeafTree beginLeaf;</div></pre></td></tr></table></figure>
<p>下面把这颗类B-树画出来<br><img src="http://s3.sinaimg.cn/middle/6e85bf42g99bbae0e70c2&amp;690" alt=""></p>
<p> 图中一个BTNode最多包含4个CFNode，每个CFNode就相当于一个簇，而每个BTNode里面的所有CFNode相当于一个大簇。当插入一个新纪录时，是从底往上修改的，所以叶子节点是等深的，用BLeafNode将所有叶子节点窜连起来，方便挖掘这颗B-树。还是用例子说明吧。</p>
<p>  先插入第一条记录，用该纪录创建一个CFNode，再用该CFNode创建一个BTNode作为根节点。图如下：<br><img src="http://s16.sinaimg.cn/middle/6e85bf42g99bbd0bdedbf&amp;690" alt=""></p>
<p>从第二条记录起就具有一般性了，插入第二条记录时，用该条记录创建一个临时CFNode，记cft,然后从根节点开始，看cft和根节点的哪个CFNode距离最近（当然目前只有一个CFNode),根据这个CFNode找到它的子BTNode（当然这里没有），一直这样下去，直到叶子节点（当然这里根节点也就是叶子节点）。假如cft和找到的最近的BTNode，记bt,的最近的那个CFNode，记cfp的距离是d,如果d小于给定的阈值minDis，则将cft和cfp合并，然后从该叶子节点向上跟新各个BTNode的信息直到跟节点，跟新的方法是将cft的信息合并到父节点的各个CFNode中（具体看代码吧）。如果d大于给定的阈值，但是bt的CFNode小于给定的阈值M，则将cft作为bt的一个新CFNode，然后依然从该叶子节点向上跟新各个BTNode的信息直到跟节点。如果bt的cfp大于给定的阈值M，则只能将bt分裂成两个BTNode,然后将原BTNode也就是bt所对应的父节点，记r，的对应的CFNode分裂成两个CFNode,如果那时r中的CFNode数目也大于M则继续向上分裂，否则向上跟新。这里有很多细节问题，也不好描叙，直接看代码吧。</p>
<p> 下面讲下这么处理字符型数据。下面是以前做的笔记。</p>
<p><img src="http://photo.blog.sina.com.cn/showpic.html#blogid=6e85bf420100om1i&amp;url=http://s16.sinaimg.cn/orignal/6e85bf42ge01595f489bf" alt=""></p>
<p>Birch算法也有不足的地方，第一，它对输入数据的先后顺序敏感，第二，每个CFNode将各条记录的数据相同的部分合并了，不能还原成原来的记录了。但是我们还是很方便求出每个簇的平均值等信息。</p>
<p>Brich算法源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// birchSelf.cpp : 定义控制台应用程序的入口点。</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="comment">//以下两个头文件调用sort给vector排序</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;functional&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="comment">//birch算法，用B-树实现,可以求非数字类型距离</span></div><div class="line"><span class="comment">//是以维为单位计算距离</span></div><div class="line"><span class="comment">//但是它又不是一个完全的B-树，因为第一，它的所有元素全部保存在叶子节点中，</span></div><div class="line"><span class="comment">//第二，在一个BTNode中的关键字间并没有大小关系</span></div><div class="line"><span class="comment">//第三，当一个BTNode中的关键字个数大于制定数时，不需要将第(M+1)/2个关键字移到上一层节点中去，</span></div><div class="line"><span class="comment">//而是之间分裂成两个BTNode，再在上层中对应的BTNode中加个关键字</span></div><div class="line"></div><div class="line"><span class="comment">//属性数目</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> attNum = <span class="number">8</span>;</div><div class="line"><span class="comment">//分支因子，叶节点和非叶节点相同</span></div><div class="line"><span class="comment">//相当于B-树的介数</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">5</span>;</div><div class="line"><span class="comment">//新的一条记录和CF的最近距离</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> minDis = <span class="number">5</span>;</div><div class="line"><span class="comment">//每个簇的记录的最小数，如果小于这个数就做一场数据处理</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">double</span> minClusters = <span class="number">20</span>;</div><div class="line"><span class="comment">//true：表示字符型,false：表示数字型</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">bool</span> charType = <span class="literal">false</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//维信息，相同值会合并起来</span></div><div class="line"><span class="comment">//要按data排序，方便后面计算距离</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">AttNode</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//值</span></div><div class="line"> <span class="built_in">string</span> data;</div><div class="line"> <span class="comment">//具有该值的记录数目</span></div><div class="line"> <span class="keyword">unsigned</span> <span class="keyword">int</span> count;</div><div class="line"> <span class="comment">//该维上下一个不同取值</span></div><div class="line"> AttNode *next; </div><div class="line">&#125;*AttTree;</div><div class="line"></div><div class="line"><span class="comment">//记录信息，也即是簇信息</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CFNode</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//记录条数</span></div><div class="line"> <span class="keyword">unsigned</span> <span class="keyword">int</span> count;</div><div class="line"> <span class="comment">//属性数组</span></div><div class="line"> <span class="comment">//每个AttNode指针带头结点，方便合并两个CFNode</span></div><div class="line"> AttNode *atts[attNum];</div><div class="line">&#125;*CFTree;</div><div class="line"></div><div class="line"><span class="comment">//B-树</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//已有CF数目</span></div><div class="line"> <span class="keyword">int</span> keyNum;</div><div class="line"> <span class="comment">//0号单元未用</span></div><div class="line">    <span class="comment">//要是模仿B-树的话，应该是M+1，但是为了方便分裂就变成M+2了</span></div><div class="line"> <span class="comment">//注意keys的第1位和ptr的0位对应，keys的第2位和ptr的1位对应，以此类推</span></div><div class="line"> CFTree keys[M+<span class="number">2</span>];</div><div class="line"> BTNode *parent;</div><div class="line"> BTNode *ptr[M+<span class="number">2</span>];</div><div class="line">&#125;*BTree;</div><div class="line"></div><div class="line"><span class="comment">//全局变量root，保存B-树的根结点</span></div><div class="line">BTree root;</div><div class="line"></div><div class="line"><span class="comment">//叶子结构体，用于将B-树的叶子节点连起来</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BLeafNode</span></span></div><div class="line">&#123;</div><div class="line"> BTree leaf;</div><div class="line"> BLeafNode *next;</div><div class="line">&#125;*BLeafTree;</div><div class="line"><span class="comment">//beginLeaft保存起始叶子节点的位置</span></div><div class="line">BLeafTree beginLeaf;</div><div class="line"></div><div class="line"><span class="comment">//通过一条记录创建一个CF</span></div><div class="line"><span class="function">CFTree <span class="title">createCF</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; data)</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//if(NULL == data)</span></div><div class="line">  <span class="comment">//return NULL;</span></div><div class="line"> <span class="keyword">int</span> i;</div><div class="line"> AttTree att = <span class="literal">NULL</span>;</div><div class="line"> CFTree cft = <span class="keyword">new</span> CFNode();</div><div class="line"> cft-&gt;count = <span class="number">1</span>;</div><div class="line"> <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; data.size(); i++)</div><div class="line"> &#123;</div><div class="line">  att = <span class="keyword">new</span> AttNode();</div><div class="line">  <span class="comment">//每个att都带头结点</span></div><div class="line">  cft-&gt;atts[i] = att;</div><div class="line">  att = <span class="keyword">new</span> AttNode();</div><div class="line">  att-&gt;count = <span class="number">1</span>;</div><div class="line">  att-&gt;data = data[i];</div><div class="line">  att-&gt;next = <span class="literal">NULL</span>;</div><div class="line">        cft-&gt;atts[i]-&gt;next = att;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">return</span> cft;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//创建一个空的CF，方便mergeCF函数</span></div><div class="line"><span class="function">CFTree <span class="title">createCF</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"> <span class="keyword">int</span> i;</div><div class="line"> AttTree att = <span class="literal">NULL</span>;</div><div class="line"> CFTree cft = <span class="keyword">new</span> CFNode();</div><div class="line"> cft-&gt;count = <span class="number">0</span>;</div><div class="line"> <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; attNum; i++)</div><div class="line"> &#123;</div><div class="line">  att = <span class="keyword">new</span> AttNode();</div><div class="line">  att-&gt;next = <span class="literal">NULL</span>;</div><div class="line">  <span class="comment">//每个att都带头结点</span></div><div class="line">  cft-&gt;atts[i] = att;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">return</span> cft;</div><div class="line">&#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment">//计算两个CF间的距离</span></div><div class="line"><span class="comment">//两个簇间的距离，如果是数字型的好很好求，就是两个簇的簇中心距离，但是对于非数字型的（既字符型）</span></div><div class="line"><span class="comment">//簇中心是不好（无法）求出来的。那么就得用另外一种方式表示。现有簇A，簇B，簇的记录的数目分别是</span></div><div class="line"><span class="comment">//M，N（M&gt;=1，N&gt;=1）。以第一维属性为列。集合S是A，B的取值。遍历 ,距离是 ，其中A 中的个数是ai，</span></div><div class="line"><span class="comment">//B中的个数是bi，0&lt;=ai&lt;=M,0&lt;=bi&lt;=N，则0&lt;= &lt;=1，取0等情况好理解，取1的情况是要么 =1并且 =0，要么相反。</span></div><div class="line"><span class="comment">//假如是前者，簇A取值只有一种情况就是i，而簇B又没有取i这种情况，那么可知 (S减去i的补集)全是簇B要取的值，</span></div><div class="line"><span class="comment">//假如为j,k,l。则dj= = ,dk= = ,dl= = ,且：dj+dk+dl =1，此时A，B没有一条数据重合，当遍历所有后，</span></div><div class="line"><span class="comment">//有di+dj+dk+dl=2，那么最终结果是1，这也是两个簇间最大的距离。若两个簇在各个值处按比例重合（ =0），</span></div><div class="line"><span class="comment">//则等于0。考虑各维情况。设空有L维，则用d= 一般x取2，即欧式距离,m表示维数。这里 0&lt;=di&lt;=1，可知0&lt;=d&lt;=1。</span></div><div class="line"><span class="comment">//上面这短话是从birch_蒋盛益.doc复制过来的，里面有些图片，无法显示，还是直接去看那个doc吧。</span></div><div class="line"><span class="comment">//同一维的的AttNode中的值已经递增排序，</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">getDistance</span><span class="params">(CFTree a,CFTree b)</span></span></div><div class="line">&#123;</div><div class="line"> <span class="keyword">double</span> d,k = <span class="number">0</span>;</div><div class="line"> <span class="keyword">int</span> i,j;</div><div class="line"> AttTree aa, ba;</div><div class="line"> <span class="comment">//字符型</span></div><div class="line">    <span class="keyword">if</span>(charType == <span class="literal">true</span>)</div><div class="line"> &#123;</div><div class="line">  <span class="comment">//距离是一维一维计算的</span></div><div class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; attNum; i++)</div><div class="line">  &#123;</div><div class="line">   <span class="comment">//跳过头结点</span></div><div class="line">   aa = a-&gt;atts[i]-&gt;next;</div><div class="line">   ba = b-&gt;atts[i]-&gt;next;</div><div class="line">   d = <span class="number">0</span>;</div><div class="line">   <span class="comment">//同一维的的AttNode中的值已经递增排序</span></div><div class="line">   <span class="keyword">while</span>(<span class="literal">NULL</span> != aa &amp;&amp; <span class="literal">NULL</span> != ba)</div><div class="line">   &#123;</div><div class="line">    <span class="keyword">if</span>( aa-&gt;data == ba-&gt;data)</div><div class="line">    &#123;</div><div class="line">     d += <span class="built_in">abs</span>(((<span class="keyword">double</span>)aa-&gt;count)/a-&gt;count - ((<span class="keyword">double</span>)ba-&gt;count)/b-&gt;count);</div><div class="line">     aa = aa-&gt;next;</div><div class="line">     ba = ba-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( aa-&gt;data &lt; ba-&gt;data)</div><div class="line">    &#123;</div><div class="line">     d += ((<span class="keyword">double</span>)aa-&gt;count)/a-&gt;count;</div><div class="line">     aa = aa-&gt;next;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">     d += ((<span class="keyword">double</span>)ba-&gt;count)/b-&gt;count;</div><div class="line">     ba = ba-&gt;next;</div><div class="line">    &#125;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">while</span>(<span class="literal">NULL</span> != aa)</div><div class="line">   &#123;</div><div class="line">    d += ((<span class="keyword">double</span>)aa-&gt;count)/a-&gt;count;</div><div class="line">    aa = aa-&gt;next;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">while</span>(<span class="literal">NULL</span> != ba)</div><div class="line">   &#123;</div><div class="line">    d += ((<span class="keyword">double</span>)ba-&gt;count)/b-&gt;count;</div><div class="line">    ba = ba-&gt;next;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   k += <span class="built_in">pow</span>(d/<span class="number">2</span>,<span class="number">2</span>);</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">else</span></div><div class="line"> &#123;</div><div class="line">  <span class="comment">//数字型</span></div><div class="line">  <span class="keyword">double</span> d1,d2;</div><div class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>; i &lt; attNum; i++)</div><div class="line">  &#123;</div><div class="line">   <span class="comment">//跳过头结点</span></div><div class="line">   aa = a-&gt;atts[i]-&gt;next;</div><div class="line">   ba = b-&gt;atts[i]-&gt;next;</div><div class="line">   d1 = <span class="number">0</span>;</div><div class="line">   <span class="comment">//获得该维的平均值</span></div><div class="line">   <span class="keyword">while</span>(<span class="literal">NULL</span> != aa)</div><div class="line">   &#123;</div><div class="line">    d1 += atoi(aa-&gt;data.c_str()) * aa-&gt;count;</div><div class="line">    aa = aa-&gt;next;</div><div class="line">   &#125;</div><div class="line">   d1 = d1/a-&gt;count;</div><div class="line">   d2 = <span class="number">0</span>;</div><div class="line">   <span class="comment">//获得该维的平均值</span></div><div class="line">   <span class="keyword">while</span>(<span class="literal">NULL</span> != ba)</div><div class="line">   &#123;</div><div class="line">    d2 += atoi(ba-&gt;data.c_str()) * ba-&gt;count;</div><div class="line">    ba = ba-&gt;next;</div><div class="line">   &#125;</div><div class="line">   d2 = d2/b-&gt;count;</div><div class="line">   <span class="comment">//</span></div><div class="line">   k += <span class="built_in">pow</span>(d1-d2,<span class="number">2</span>);</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">return</span> <span class="built_in">sqrt</span>(k/attNum);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//在B-树（root是跟节点)中找到离cft最近的那个CF和BTree，分别保存在cfp和bt中，然后返回距离</span></div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">getMinCF</span><span class="params">(BTree root, CFTree cft, CFTree &amp;cfp, BTree &amp;bt)</span></span></div><div class="line">&#123;</div><div class="line"> <span class="keyword">if</span>(<span class="literal">NULL</span> == root || <span class="literal">NULL</span> == cft)</div><div class="line">  <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line"> <span class="keyword">double</span> b,d;</div><div class="line"> <span class="keyword">int</span> i,j;</div><div class="line"> BTree t = root;</div><div class="line">    <span class="comment">//先访问完整个BTree，找到最近的那个关键字，再在这个关键字的下一层节点中查找，直到叶子节点</span></div><div class="line"> <span class="keyword">while</span>(<span class="literal">NULL</span> != t)</div><div class="line"> &#123;</div><div class="line">  bt = t;</div><div class="line">  d = <span class="number">10000</span>;</div><div class="line">  <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt;= t-&gt;keyNum; i++)</div><div class="line">  &#123;</div><div class="line">   b = getDistance(t-&gt;keys[i], cft);</div><div class="line">   <span class="keyword">if</span>( b &lt; d)</div><div class="line">   &#123;</div><div class="line">    d = b;</div><div class="line">    j = i;</div><div class="line">    cfp = t-&gt;keys[i];</div><div class="line">   &#125;</div><div class="line">  &#125;</div><div class="line">  t = t-&gt;ptr[j<span class="number">-1</span>];</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="keyword">return</span> d; </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//将b合并到a中</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeCF</span><span class="params">(CFTree &amp;a, CFTree b)</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//一维一维的合并</span></div><div class="line"> <span class="keyword">int</span> i;</div><div class="line"> AttTree aa,ba,p,t;</div><div class="line"> a-&gt;count += b-&gt;count;</div><div class="line"> <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; attNum; i++)</div><div class="line"> &#123;</div><div class="line">  aa = a-&gt;atts[i]-&gt;next;</div><div class="line">  ba = b-&gt;atts[i]-&gt;next;</div><div class="line">  <span class="comment">//保存头结点，方便把ba插入到aa前面去</span></div><div class="line">  t = a-&gt;atts[i]; </div><div class="line"> </div><div class="line">  <span class="comment">//同一维的AttNode中的值已经递增排序，</span></div><div class="line">  <span class="keyword">while</span>( <span class="literal">NULL</span> != aa &amp;&amp; <span class="literal">NULL</span> != ba)</div><div class="line">  &#123;</div><div class="line">   <span class="keyword">if</span>(aa-&gt;data == ba-&gt;data)</div><div class="line">   &#123;</div><div class="line">    aa-&gt;count += ba-&gt;count;</div><div class="line">    t = aa;</div><div class="line">    aa = aa-&gt;next;</div><div class="line">    ba = ba-&gt;next;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">else</span> <span class="keyword">if</span>( aa-&gt;data &lt; ba-&gt;data)</div><div class="line">   &#123;</div><div class="line">    t = aa;</div><div class="line">    aa = aa-&gt;next;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">else</span></div><div class="line">   &#123;</div><div class="line">    <span class="comment">//要将ba插入到aa前面去，即插在t的后面</span></div><div class="line">    p = <span class="keyword">new</span> AttNode();</div><div class="line">    p-&gt;count = ba-&gt;count;</div><div class="line">    p-&gt;data = ba-&gt;data;</div><div class="line">    p-&gt;next = aa;</div><div class="line">    t-&gt;next = p;</div><div class="line">    t = p;</div><div class="line"></div><div class="line">    ba = ba-&gt;next;</div><div class="line">   &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">//ba还有剩余</span></div><div class="line">  <span class="keyword">while</span>(<span class="literal">NULL</span> != ba)</div><div class="line">  &#123;</div><div class="line">   <span class="comment">//要将ba添加到aa的后面</span></div><div class="line">   p = <span class="keyword">new</span> AttNode();</div><div class="line">   p-&gt;count = ba-&gt;count;</div><div class="line">   p-&gt;data = ba-&gt;data;</div><div class="line">   p-&gt;next = <span class="literal">NULL</span>;</div><div class="line">   t-&gt;next = p;</div><div class="line">   t = p;</div><div class="line"></div><div class="line">   ba = ba-&gt;next;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//更新BTree中ptr指针等于a的那个CF,把b添加到那个CF中</span></div><div class="line"><span class="comment">//a的父节点不为空</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateBTree</span><span class="params">(BTree a, CFTree b)</span></span></div><div class="line">&#123;</div><div class="line"> <span class="keyword">int</span> i;</div><div class="line"> BTree t = a-&gt;parent;</div><div class="line"> <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt;= t-&gt;keyNum; i++)</div><div class="line"> &#123;</div><div class="line">  <span class="keyword">if</span>(t-&gt;ptr[i<span class="number">-1</span>] == a)</div><div class="line">  &#123;</div><div class="line">   mergeCF(t-&gt;keys[i], b);</div><div class="line">   <span class="keyword">break</span>;</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">if</span>( <span class="literal">NULL</span> != t-&gt;parent)</div><div class="line"> &#123;</div><div class="line">  updateBTree(t,b);</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//释放节点a的资源</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">freeBTree</span><span class="params">(BTree a)</span></span></div><div class="line">&#123;</div><div class="line"> <span class="keyword">delete</span> a;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//a分离成两个BTree，至到根节点</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">apartBTree</span><span class="params">(BTree a, CFTree b,<span class="keyword">bool</span> isFirst)</span></span></div><div class="line">&#123;</div><div class="line"> CFTree p,q;</div><div class="line"> BTree c,d,r;</div><div class="line"> <span class="keyword">int</span> i,j,k,l;</div><div class="line"> <span class="keyword">double</span> d1,d2 = <span class="number">0</span>;</div><div class="line"></div><div class="line"> <span class="comment">//选两个相距最远的CFTree,保存在k,l中</span></div><div class="line"> <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; a-&gt;keyNum; i++)</div><div class="line">  <span class="keyword">for</span>(j = i+<span class="number">1</span>; j &lt;= a-&gt;keyNum; j++)</div><div class="line">  &#123;</div><div class="line">   d1 = getDistance(a-&gt;keys[i],a-&gt;keys[j]);</div><div class="line">   <span class="keyword">if</span>( d2 &lt; d1)</div><div class="line">   &#123;</div><div class="line">    d2 = d1;</div><div class="line">    k = i;</div><div class="line">    l = j;</div><div class="line">   &#125;</div><div class="line">  &#125;</div><div class="line"> <span class="comment">//以k,l生成两个BTree</span></div><div class="line"> c = <span class="keyword">new</span> BTNode();</div><div class="line"> d = <span class="keyword">new</span> BTNode();</div><div class="line"> c-&gt;keyNum = <span class="number">1</span>;</div><div class="line"> p = createCF();</div><div class="line"> mergeCF(p,a-&gt;keys[k]);</div><div class="line"> c-&gt;keys[<span class="number">1</span>] = p;</div><div class="line"> c-&gt;ptr[<span class="number">0</span>] = a-&gt;ptr[k<span class="number">-1</span>];</div><div class="line"> <span class="keyword">if</span>(<span class="literal">NULL</span> != a-&gt;ptr[k<span class="number">-1</span>])</div><div class="line"> &#123;</div><div class="line">  a-&gt;ptr[k<span class="number">-1</span>]-&gt;parent = c;</div><div class="line"> &#125;</div><div class="line"> d-&gt;keyNum = <span class="number">1</span>;</div><div class="line"> p = createCF();</div><div class="line"> mergeCF(p,a-&gt;keys[l]);</div><div class="line"> d-&gt;keys[<span class="number">1</span>] = p;</div><div class="line"> d-&gt;ptr[<span class="number">0</span>] = a-&gt;ptr[l<span class="number">-1</span>];</div><div class="line"> <span class="keyword">if</span>(<span class="literal">NULL</span> != a-&gt;ptr[l<span class="number">-1</span>])</div><div class="line"> &#123;</div><div class="line">  a-&gt;ptr[l<span class="number">-1</span>]-&gt;parent = d;</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> <span class="comment">//静态变量，因为只有第一次分裂时需要调整叶子节点，以后分裂都不是在叶子节点上了</span></div><div class="line"> <span class="keyword">if</span>(isFirst)</div><div class="line"> &#123;</div><div class="line">  BLeafTree t1,t2,t3;</div><div class="line">  <span class="comment">//找到指向a的叶子节点指针，保存在t1中</span></div><div class="line">  <span class="keyword">for</span>(t1 = beginLeaf; t1-&gt;leaf != a; t1 = t1-&gt;next);</div><div class="line">  <span class="comment">//将叶子节点重新穿起来</span></div><div class="line">  t2 = t1-&gt;next;</div><div class="line">  t1-&gt;leaf = c;</div><div class="line">  t3 = <span class="keyword">new</span> BLeafNode();</div><div class="line">  t3-&gt;leaf = d;</div><div class="line">  t3-&gt;next = t2;</div><div class="line">  t1-&gt;next = t3;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="comment">//再将a中剩下的CF分配到离它近的c或者d中,既k或者l中</span></div><div class="line"> <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt;= a-&gt;keyNum; i++)</div><div class="line"> &#123;</div><div class="line">  <span class="keyword">if</span>(i == k || i == l)</div><div class="line">   <span class="keyword">continue</span>;</div><div class="line">  d1 = getDistance(a-&gt;keys[k],a-&gt;keys[i]);</div><div class="line">  d2 = getDistance(a-&gt;keys[l],a-&gt;keys[i]);</div><div class="line"></div><div class="line">  <span class="comment">//将a-&gt;keys[i]添加到c中</span></div><div class="line">  <span class="keyword">if</span>( d1 &lt;= d2)</div><div class="line">  &#123;</div><div class="line">   c-&gt;keyNum++;</div><div class="line">   c-&gt;keys[c-&gt;keyNum] = a-&gt;keys[i];</div><div class="line">   c-&gt;ptr[c-&gt;keyNum<span class="number">-1</span>] = a-&gt;ptr[i<span class="number">-1</span>];</div><div class="line">   <span class="keyword">if</span>(<span class="literal">NULL</span> != a-&gt;ptr[i<span class="number">-1</span>])</div><div class="line">   &#123;</div><div class="line">    a-&gt;ptr[i<span class="number">-1</span>]-&gt;parent = c;</div><div class="line">   &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">//将a-&gt;keys[i]添加到d中</span></div><div class="line">  <span class="keyword">else</span></div><div class="line">  &#123;</div><div class="line">   d-&gt;keyNum++;</div><div class="line">   d-&gt;keys[d-&gt;keyNum] = a-&gt;keys[i];</div><div class="line">   d-&gt;ptr[d-&gt;keyNum<span class="number">-1</span>] = a-&gt;ptr[i<span class="number">-1</span>];</div><div class="line">   <span class="keyword">if</span>(<span class="literal">NULL</span> != a-&gt;ptr[i<span class="number">-1</span>])</div><div class="line">   &#123;</div><div class="line">    a-&gt;ptr[i<span class="number">-1</span>]-&gt;parent = d;</div><div class="line">   &#125;</div><div class="line">  &#125;   </div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> <span class="comment">//更新a的父节点</span></div><div class="line"> <span class="comment">//如果a没有父节点，即a就是父节点，则创建新的父节点，停止更新下去</span></div><div class="line"> <span class="keyword">if</span>( <span class="literal">NULL</span> == a-&gt;parent)</div><div class="line"> &#123;</div><div class="line">  <span class="comment">//创建新的父节点r，它两个关键字</span></div><div class="line">  r = <span class="keyword">new</span> BTNode();</div><div class="line">  r-&gt;keyNum = <span class="number">2</span>;</div><div class="line">  r-&gt;parent = <span class="literal">NULL</span>;</div><div class="line">  r-&gt;ptr[<span class="number">0</span>] = c;</div><div class="line">  c-&gt;parent = r;</div><div class="line">  r-&gt;ptr[<span class="number">1</span>] = d;</div><div class="line">  d-&gt;parent = r;</div><div class="line">  <span class="comment">//将c中所有CF合并到p中，再将p作为r的一个关键字</span></div><div class="line">  p = createCF();</div><div class="line">  <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt;= c-&gt;keyNum; i++)</div><div class="line">  &#123;</div><div class="line">   mergeCF(p,c-&gt;keys[i]);</div><div class="line">  &#125;</div><div class="line">  r-&gt;keys[<span class="number">1</span>] = p;</div><div class="line">  <span class="comment">//将d中所有CF合并到p中，再将p作为r的一个关键字</span></div><div class="line">  p = createCF();</div><div class="line">  <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt;= d-&gt;keyNum; i++)</div><div class="line">  &#123;</div><div class="line">   mergeCF(p,d-&gt;keys[i]);</div><div class="line">  &#125;</div><div class="line">  r-&gt;keys[<span class="number">2</span>] = p;</div><div class="line"></div><div class="line">  <span class="comment">//重新指定根节点</span></div><div class="line">  root = r;</div><div class="line">  </div><div class="line">  <span class="comment">//释放a的资源</span></div><div class="line">  freeBTree(a);</div><div class="line"></div><div class="line">  <span class="keyword">return</span>;</div><div class="line"> &#125;</div><div class="line"> <span class="comment">//a有父节点</span></div><div class="line"> <span class="comment">//获得父节点</span></div><div class="line"> r = a-&gt;parent;</div><div class="line"> <span class="comment">//找到a在c中关键字的位置</span></div><div class="line"> <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt;= r-&gt;keyNum; i++)</div><div class="line"> &#123;</div><div class="line">  <span class="keyword">if</span>( a == r-&gt;ptr[i<span class="number">-1</span>])</div><div class="line">   <span class="keyword">break</span>;</div><div class="line"> &#125;</div><div class="line"> <span class="comment">//将该关键字删除，根据c,d创建两个新的关键字</span></div><div class="line"> <span class="comment">//具体做法是将从第i位关键字开始的所有关键字和对应的ptr指针后移一维，</span></div><div class="line"> <span class="comment">//再在原第i和i+1位放入新的关键字和新的ptr指针</span></div><div class="line"> r-&gt;keyNum++;</div><div class="line"> <span class="keyword">for</span>(j = r-&gt;keyNum; j &gt; i+<span class="number">1</span>; j--)</div><div class="line"> &#123;</div><div class="line">  r-&gt;keys[j] = r-&gt;keys[j<span class="number">-1</span>];</div><div class="line">  r-&gt;ptr[j<span class="number">-1</span>] = r-&gt;ptr[j<span class="number">-2</span>];</div><div class="line"> &#125;</div><div class="line"> <span class="comment">//将c中所有CF合并到p中，再将p作为r的一个关键字</span></div><div class="line"> p = createCF();</div><div class="line"> <span class="keyword">for</span>(j = <span class="number">1</span>; j &lt;= c-&gt;keyNum; j++)</div><div class="line"> &#123;</div><div class="line">  mergeCF(p,c-&gt;keys[j]);</div><div class="line"> &#125;</div><div class="line"> r-&gt;keys[i] = p;</div><div class="line"> r-&gt;ptr[i<span class="number">-1</span>] = c;</div><div class="line"> c-&gt;parent = r;</div><div class="line"> <span class="comment">//将d中所有CF合并到p中，再将p作为r的一个关键字</span></div><div class="line"> p = createCF();</div><div class="line"> <span class="keyword">for</span>(j = <span class="number">1</span>; j &lt;= d-&gt;keyNum; j++)</div><div class="line"> &#123;</div><div class="line">  mergeCF(p,d-&gt;keys[j]);</div><div class="line"> &#125;</div><div class="line"> r-&gt;keys[i+<span class="number">1</span>] = p;</div><div class="line"> r-&gt;ptr[i] = d;</div><div class="line"> d-&gt;parent = r;</div><div class="line"></div><div class="line"> <span class="comment">//释放a的资源</span></div><div class="line"> freeBTree(a);</div><div class="line"></div><div class="line"> <span class="comment">//如果c中的关键字个数大于M则递归</span></div><div class="line"> <span class="keyword">if</span>(r-&gt;keyNum &gt; M)</div><div class="line"> &#123;</div><div class="line">  apartBTree(r,b,<span class="literal">false</span>);</div><div class="line"> &#125;</div><div class="line"> <span class="comment">//此时，又要更新r节点了</span></div><div class="line"> <span class="keyword">else</span> <span class="keyword">if</span>(<span class="literal">NULL</span> != r-&gt;parent)</div><div class="line"> &#123;</div><div class="line">  updateBTree(r,b);</div><div class="line"> &#125;</div><div class="line"> <span class="comment">//否则停止更新</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//按层显示树信息,root是根节点</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">displayBTree</span><span class="params">(BTree root, <span class="keyword">int</span> n)</span></span></div><div class="line">&#123;</div><div class="line"> <span class="keyword">int</span> i,j,k;</div><div class="line"> BTree t,p;</div><div class="line"> t = root;</div><div class="line"> j = <span class="number">0</span>;</div><div class="line"> <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt;= t-&gt;keyNum; i++)</div><div class="line"> &#123;</div><div class="line">  j += t-&gt;keys[i]-&gt;count;</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">if</span>(n != j)</div><div class="line"> &#123;</div><div class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"j="</span> &lt;&lt; j &lt;&lt; <span class="string">",n="</span> &lt;&lt; n &lt;&lt; <span class="string">","</span>;</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">if</span>(<span class="literal">NULL</span> != t-&gt;ptr[<span class="number">0</span>])</div><div class="line"> &#123;</div><div class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; t-&gt;keyNum; i++)</div><div class="line">  &#123;</div><div class="line">   p = t-&gt;ptr[i];</div><div class="line">   displayBTree(p,t-&gt;keys[i+<span class="number">1</span>]-&gt;count);</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//创建B-树</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">createBTree</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"> <span class="comment">//临时变量</span></div><div class="line"> CFTree cft,cfp;</div><div class="line"> AttTree att;</div><div class="line"> BTree bt,t;</div><div class="line"> <span class="keyword">int</span> i,j,k;</div><div class="line"> <span class="keyword">double</span> d;</div><div class="line"> <span class="comment">//读文件，每条记录保存在data里面</span></div><div class="line"> <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; data;</div><div class="line">    <span class="keyword">bool</span> isFirst = <span class="literal">true</span>;</div><div class="line"> <span class="keyword">char</span> str[<span class="number">30</span>];</div><div class="line"> <span class="keyword">char</span> ch;</div><div class="line"> FILE *infile;</div><div class="line"> <span class="comment">//const char *FileName= "mushroom.data";</span></div><div class="line"> <span class="keyword">const</span> <span class="keyword">char</span> *FileName= <span class="string">"chr10.cns5.txt"</span>;</div><div class="line"> <span class="keyword">if</span>(!(infile=fopen(FileName,<span class="string">"r"</span>)))</div><div class="line"> &#123;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"数据文件不存在！\n"</span>);</div><div class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</div><div class="line"> &#125;</div><div class="line"> <span class="comment">//保存记录条数</span></div><div class="line"> k = <span class="number">0</span>;</div><div class="line"> <span class="keyword">while</span>(!feof(infile))</div><div class="line"> &#123;</div><div class="line">  data.clear();</div><div class="line">  <span class="comment">//renhu:一条记录</span></div><div class="line">  <span class="comment">//保存维数</span></div><div class="line">  i = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>(!feof(infile) &amp;&amp; i&lt;attNum)</div><div class="line">  &#123;</div><div class="line">   j=<span class="number">0</span>;</div><div class="line">   <span class="comment">//renhu:该条记录的一个维上的值</span></div><div class="line">   <span class="keyword">do</span></div><div class="line">   &#123;</div><div class="line">    ch=getc(infile);</div><div class="line">    str[j++]=ch;</div><div class="line">   &#125;<span class="keyword">while</span>(ch!=<span class="string">','</span> &amp;&amp; ch!=<span class="string">'\n'</span> &amp;&amp; !feof(infile) );</div><div class="line">   str[j<span class="number">-1</span>]=<span class="string">'\0'</span>;</div><div class="line">   data.push_back(str);</div><div class="line">   i++;</div><div class="line">  &#125;</div><div class="line">  k++;</div><div class="line"> </div><div class="line">  <span class="comment">//第一条记录要特殊处理</span></div><div class="line">  <span class="keyword">if</span>(isFirst)</div><div class="line">  &#123;</div><div class="line">   <span class="comment">//用第零条记录创建一个CF</span></div><div class="line">   cft = createCF(data);</div><div class="line">   </div><div class="line">   <span class="comment">//创建根节点</span></div><div class="line">   root = <span class="keyword">new</span> BTNode();</div><div class="line">   root-&gt;keyNum = <span class="number">1</span>;</div><div class="line">   root-&gt;keys[<span class="number">1</span>] = cft;</div><div class="line">   root-&gt;parent = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">   <span class="comment">//构造叶子节点信息</span></div><div class="line">   beginLeaf = <span class="keyword">new</span> BLeafNode();</div><div class="line">   beginLeaf-&gt;leaf = root;</div><div class="line">   beginLeaf-&gt;next = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line">   isFirst = <span class="literal">false</span>;</div><div class="line">   <span class="keyword">continue</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">//if(k == 100000)</span></div><div class="line">  <span class="comment">// break;</span></div><div class="line">  displayBTree(root, k<span class="number">-1</span>);</div><div class="line">  <span class="comment">//离最近CF的距离</span></div><div class="line">  d = <span class="number">1000000</span>;</div><div class="line">  <span class="comment">//把每条记录当做一个CF讨论</span></div><div class="line">  cft = createCF(data);</div><div class="line">  <span class="comment">//cfp保存最近的CF,bt保存最近的BTree</span></div><div class="line">  d = getMinCF(root, cft, cfp, bt);</div><div class="line">  <span class="comment">//下面分3种情况讨论</span></div><div class="line">  <span class="comment">//直接把cfp合并到cft，然后从bt的父节点起更新</span></div><div class="line">  <span class="keyword">if</span>(d &lt;= minDis)</div><div class="line">  &#123;</div><div class="line">   <span class="comment">//将cft合并到cfp中</span></div><div class="line">   mergeCF(cfp, cft);</div><div class="line">   <span class="keyword">if</span>( <span class="literal">NULL</span> != bt-&gt;parent)</div><div class="line">   &#123;</div><div class="line">    updateBTree(bt, cft);</div><div class="line">   &#125;   </div><div class="line">  &#125;</div><div class="line">  <span class="comment">//把cft作为一个新的CF放在bt中，然后从bt的父节点起更新</span></div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span>( bt-&gt;keyNum &lt; M)</div><div class="line">  &#123;</div><div class="line">   bt-&gt;keyNum += <span class="number">1</span>;</div><div class="line">   bt-&gt;keys[bt-&gt;keyNum] = cft;   </div><div class="line">   <span class="keyword">if</span>( <span class="literal">NULL</span> != bt-&gt;parent)</div><div class="line">   &#123;</div><div class="line">    updateBTree(bt, cft);</div><div class="line">   &#125;   </div><div class="line">  &#125;</div><div class="line">  <span class="comment">//把cft作为一个新的CF放在bt中，然后从bt起分裂至根节点</span></div><div class="line">  <span class="keyword">else</span></div><div class="line">  &#123;</div><div class="line">   bt-&gt;keyNum += <span class="number">1</span>;</div><div class="line">   bt-&gt;keys[bt-&gt;keyNum] = cft; </div><div class="line">   apartBTree(bt, cft,<span class="literal">true</span>);</div><div class="line">  &#125;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"完成了！"</span>&lt;&lt; <span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//每个CF作为一个簇挖掘</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">miningByCF</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"> BLeafTree ltemp = beginLeaf;</div><div class="line"> BTree ttemp = <span class="literal">NULL</span>;</div><div class="line"> CFTree ctemp = <span class="literal">NULL</span>;</div><div class="line"> AttTree atemp = <span class="literal">NULL</span>;</div><div class="line"> <span class="keyword">int</span> btNum =<span class="number">0</span>;</div><div class="line"> <span class="keyword">int</span> cfNum = <span class="number">0</span>;</div><div class="line"> <span class="keyword">int</span> sum = <span class="number">0</span>;</div><div class="line"> <span class="keyword">do</span></div><div class="line"> &#123;</div><div class="line">  ttemp = ltemp-&gt;leaf;</div><div class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"第 "</span> &lt;&lt; ++btNum &lt;&lt; <span class="string">" 个BTNode，有 "</span> &lt;&lt; ttemp-&gt;keyNum &lt;&lt; <span class="string">" 个簇。"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">  cfNum = <span class="number">0</span>;</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= ttemp-&gt;keyNum; i++)</div><div class="line">  &#123;</div><div class="line">   ctemp = ttemp-&gt;keys[i];</div><div class="line">   sum += ctemp-&gt;count;</div><div class="line">   <span class="built_in">cout</span> &lt;&lt; <span class="string">"第 "</span> &lt;&lt; ++cfNum &lt;&lt; <span class="string">" 个簇有 "</span> &lt;&lt; ctemp-&gt;count &lt;&lt; <span class="string">" 条记录，"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">   <span class="keyword">if</span>(ctemp-&gt;count &lt; minClusters)</div><div class="line">   &#123;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"这个簇数据太少，属于异常簇，请注意"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j &lt; attNum; j++)</div><div class="line">   &#123;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"第 "</span> &lt;&lt; j+<span class="number">1</span> &lt;&lt; <span class="string">" 维属性有中取"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    atemp = ctemp-&gt;atts[j]-&gt;next;</div><div class="line">    <span class="keyword">while</span>(atemp != <span class="literal">NULL</span>)</div><div class="line">    &#123;</div><div class="line">     <span class="built_in">cout</span> &lt;&lt; <span class="string">"值为 "</span> &lt;&lt; atemp-&gt;data &lt;&lt; <span class="string">"有 "</span> &lt;&lt; atemp-&gt;count &lt;&lt; <span class="string">"次，在该簇中的比例是 "</span> &lt;&lt; (<span class="keyword">double</span>)atemp-&gt;count/ctemp-&gt;count &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">     atemp = atemp-&gt;next;</div><div class="line">    &#125;</div><div class="line">   &#125;</div><div class="line">  &#125;</div><div class="line"> &#125;<span class="keyword">while</span>(ltemp=ltemp-&gt;next);</div><div class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"共有 "</span> &lt;&lt; sum &lt;&lt; <span class="string">" 条记录"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getHeuristicThreshold</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> _tmain(<span class="keyword">int</span> argc, _TCHAR* argv[])</div><div class="line">&#123;</div><div class="line"> <span class="keyword">time_t</span> timeBegin,timeEnd,timeCost;</div><div class="line"> time(&amp;timeBegin);</div><div class="line">    <span class="built_in">cout</span>  &lt;&lt; <span class="string">"开始创建B-树的时间是："</span> &lt;&lt; ctime(&amp;timeBegin) &lt;&lt; <span class="built_in">endl</span>;</div><div class="line"> createBTree();</div><div class="line"></div><div class="line"> miningByCF();</div><div class="line"> time(&amp;timeEnd);</div><div class="line"> <span class="built_in">cout</span> &lt;&lt; <span class="string">"完成创建B-树的时间是："</span> &lt;&lt; ctime(&amp;timeEnd) &lt;&lt; <span class="string">"耗时："</span> &lt;&lt; timeEnd -timeBegin &lt;&lt; <span class="string">"秒"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">  </div><div class="line"> </div><div class="line"> <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注：这几个博客的作者都是机器学习的，他们的文章也不错<br>Rocchio算法  <a href="http://blog.csdn.net/sulliy/article/details/6670980" target="_blank" rel="external">http://blog.csdn.net/sulliy/article/details/6670980</a><br><a href="http://blog.csdn.net/sulliy/article/category/852041" target="_blank" rel="external">http://blog.csdn.net/sulliy/article/category/852041</a><br>面向对象设计模式  <a href="http://blog.sina.com.cn/s/articlelist_1610791280_4_1.html" target="_blank" rel="external">http://blog.sina.com.cn/s/articlelist_1610791280_4_1.html</a><br>各种数据挖掘算法和搜索算法<br><a href="http://blog.sina.com.cn/s/articlelist_1610791280_3_1.html" target="_blank" rel="external">http://blog.sina.com.cn/s/articlelist_1610791280_3_1.html</a></p>
    </div>

    <div class="post-footer">   
        <div>
            
                转载声明: 商业转载请联系作者获得授权,非商业转载请注明出处 © Snippet
            
        </div>
        <div>
            
                版权声明: <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" target="_blank">
知识共享署名-非商业性使用-禁止演绎 3.0 未本地化版本许可协议（CC BY-NC-ND 3.0）
</a>
            
        </div>  
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2016/02/05/Android混淆打包详解/" class="pre-post btn btn-default"><i class="fa fa-angle-left fa-fw"></i>上一篇</a>
    
    
        <a href="/2016/01/25/调试Hybrid/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        <div id="uyan_frame"></div>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2120654"></script>
    </div>
                </main>
                <aside class="col-md-4 sidebar">
        
        <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>主题Snippet v1.1.0版本即将上线，敬请期待~ <br>
主题下载：<a href="https://github.com/shenliyang/hexo-theme-snippet" title="fork me" target="_blank">Snippet主题</a> <br>
<hr>前端工程师一枚，专注于前端Node、React和移动端Android和Ios开发，欢迎骚扰。
<br>联系方式：qq群:278792776（移动群）、515980159（React群）、188716429（猎头hr群）
</p>
        </div>
    </div>
        
        <div class="widget">
        <h3 class="title">分类</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/"><i class="fa" aria-hidden="true">Android</i></a><span class="category-list-count">36</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/系统/"><i class="fa" aria-hidden="true">系统</i></a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/"><i class="fa" aria-hidden="true">Google</i></a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Google/VR/"><i class="fa" aria-hidden="true">VR</i></a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/"><i class="fa" aria-hidden="true">Java</i></a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/"><i class="fa" aria-hidden="true">Kotlin</i></a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/"><i class="fa" aria-hidden="true">Python</i></a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React-Native/"><i class="fa" aria-hidden="true">React Native</i></a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/"><i class="fa" aria-hidden="true">Spring</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/"><i class="fa" aria-hidden="true">android</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/"><i class="fa" aria-hidden="true">iOS</i></a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios/"><i class="fa" aria-hidden="true">ios</i></a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人工智能/"><i class="fa" aria-hidden="true">人工智能</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/"><i class="fa" aria-hidden="true">前端</i></a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/"><i class="fa" aria-hidden="true">后端</i></a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/小程序/"><i class="fa" aria-hidden="true">小程序</i></a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术人生/"><i class="fa" aria-hidden="true">技术人生</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/"><i class="fa" aria-hidden="true">机器学习</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/"><i class="fa" aria-hidden="true">杂谈</i></a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/"><i class="fa" aria-hidden="true">编程语言</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/"><i class="fa" aria-hidden="true">设计模式</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/资料库/"><i class="fa" aria-hidden="true">资料库</i></a><span class="category-list-count">1</span></li></ul>
    </div>
        
        <div class="widget">
      <h3 class="title">归档</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/"><i class="fa" aria-hidden="true">十一月 2017</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/"><i class="fa" aria-hidden="true">十月 2017</i></a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/"><i class="fa" aria-hidden="true">九月 2017</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/"><i class="fa" aria-hidden="true">八月 2017</i></a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/"><i class="fa" aria-hidden="true">七月 2017</i></a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/"><i class="fa" aria-hidden="true">六月 2017</i></a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/"><i class="fa" aria-hidden="true">五月 2017</i></a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/"><i class="fa" aria-hidden="true">四月 2017</i></a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/"><i class="fa" aria-hidden="true">三月 2017</i></a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/"><i class="fa" aria-hidden="true">二月 2017</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/"><i class="fa" aria-hidden="true">一月 2017</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/"><i class="fa" aria-hidden="true">十二月 2016</i></a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/"><i class="fa" aria-hidden="true">十一月 2016</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/"><i class="fa" aria-hidden="true">十月 2016</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/"><i class="fa" aria-hidden="true">九月 2016</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/"><i class="fa" aria-hidden="true">八月 2016</i></a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/"><i class="fa" aria-hidden="true">七月 2016</i></a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/"><i class="fa" aria-hidden="true">六月 2016</i></a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/"><i class="fa" aria-hidden="true">五月 2016</i></a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/"><i class="fa" aria-hidden="true">四月 2016</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/"><i class="fa" aria-hidden="true">三月 2016</i></a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/"><i class="fa" aria-hidden="true">二月 2016</i></a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/"><i class="fa" aria-hidden="true">一月 2016</i></a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/"><i class="fa" aria-hidden="true">九月 2015</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/"><i class="fa" aria-hidden="true">六月 2015</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/"><i class="fa" aria-hidden="true">五月 2015</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/"><i class="fa" aria-hidden="true">四月 2015</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/"><i class="fa" aria-hidden="true">三月 2015</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/"><i class="fa" aria-hidden="true">一月 2015</i></a><span class="archive-list-count">1</span></li></ul>
    </div>
        
        <div class="widget">
    <h3 class="title">标签云</h3>
    <div class="content tag-cloud">
      
        <a href="/tags/AR/" style="font-size: 1em">AR</a> <a href="/tags/Android/" style="font-size: 1em">Android</a> <a href="/tags/深入系统/" style="font-size: 1em">深入系统</a> <a href="/tags/系统服务/" style="font-size: 1em">系统服务</a> <a href="/tags/android/" style="font-size: 1em">android</a> <a href="/tags/混淆打包/" style="font-size: 1em">混淆打包</a> <a href="/tags/硬件/" style="font-size: 1em">硬件</a> <a href="/tags/前端/" style="font-size: 1em">前端</a> <a href="/tags/Angular2/" style="font-size: 1em">Angular2</a> <a href="/tags/前端开发/" style="font-size: 1em">前端开发</a> <a href="/tags/React-Native/" style="font-size: 1em">React Native</a> <a href="/tags/FlexBox布局/" style="font-size: 1em">FlexBox布局</a> <a href="/tags/后端/" style="font-size: 1em">后端</a> <a href="/tags/Java/" style="font-size: 1em">Java</a> <a href="/tags/垃圾回收/" style="font-size: 1em">垃圾回收</a> <a href="/tags/Google/" style="font-size: 1em">Google</a> <a href="/tags/VR/" style="font-size: 1em">VR</a> <a href="/tags/Kotlin/" style="font-size: 1em">Kotlin</a> <a href="/tags/编程语言/" style="font-size: 1em">编程语言</a> <a href="/tags/Node/" style="font-size: 1em">Node</a> <a href="/tags/Promise/" style="font-size: 1em">Promise</a> <a href="/tags/OpenGL/" style="font-size: 1em">OpenGL</a> <a href="/tags/调试/" style="font-size: 1em">调试</a> <a href="/tags/eact-Native/" style="font-size: 1em">eact Native</a> <a href="/tags/打包/" style="font-size: 1em">打包</a> <a href="/tags/原生/" style="font-size: 1em">原生</a> <a href="/tags/Spring/" style="font-size: 1em">Spring</a> <a href="/tags/入门/" style="font-size: 1em">入门</a> <a href="/tags/新特性/" style="font-size: 1em">新特性</a> <a href="/tags/ios/" style="font-size: 1em">ios</a> <a href="/tags/Swift/" style="font-size: 1em">Swift</a> <a href="/tags/swift/" style="font-size: 1em">swift</a> <a href="/tags/iOS/" style="font-size: 1em">iOS</a> <a href="/tags/知识库/" style="font-size: 1em">知识库</a> <a href="/tags/Xcode/" style="font-size: 1em">Xcode</a> <a href="/tags/webpack/" style="font-size: 1em">webpack</a> <a href="/tags/gulp/" style="font-size: 1em">gulp</a> <a href="/tags/https/" style="font-size: 1em">https</a> <a href="/tags/mac/" style="font-size: 1em">mac</a> <a href="/tags/环境/" style="font-size: 1em">环境</a> <a href="/tags/gif/" style="font-size: 1em">gif</a> <a href="/tags/杂谈/" style="font-size: 1em">杂谈</a> <a href="/tags/react/" style="font-size: 1em">react</a> <a href="/tags/原理/" style="font-size: 1em">原理</a> <a href="/tags/小程序/" style="font-size: 1em">小程序</a> <a href="/tags/微信/" style="font-size: 1em">微信</a> <a href="/tags/全栈/" style="font-size: 1em">全栈</a> <a href="/tags/个人博客/" style="font-size: 1em">个人博客</a> <a href="/tags/流量/" style="font-size: 1em">流量</a> <a href="/tags/机器学习/" style="font-size: 1em">机器学习</a> <a href="/tags/搭建网站/" style="font-size: 1em">搭建网站</a> <a href="/tags/深入理解/" style="font-size: 1em">深入理解</a> <a href="/tags/算法/" style="font-size: 1em">算法</a> <a href="/tags/人工智能/" style="font-size: 1em">人工智能</a> <a href="/tags/内存分配/" style="font-size: 1em">内存分配</a> <a href="/tags/设计模式/" style="font-size: 1em">设计模式</a> <a href="/tags/Python/" style="font-size: 1em">Python</a>
    </div>
  </div>
        
        <div class="widget">
        <h3 class="title">友链</h3>
        <div class="content friends-link">
        
            <a href="http://blog.csdn.net/xiangzhihong8/" class="fa" target="_blank">作者博客</a>
        
            <a href="https://yq.aliyun.com/u/xiangzhihong" class="fa" target="_blank">阿里云博客</a>
        
        </div>
    </div>
        
    </aside>
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<!--page counter part-->
<script>
function addCount (Counter) {
        url=$('.article-date').attr('href').trim();
        title = $('.article-title').text().trim();
        var query=new AV.Query(Counter);
        //use url as unique idnetfication
        query.equalTo("url",url);
        query.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("title",title);
                    newcounter.set("url",url);
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                        //alert('New object created');
                        },
                        error: function(newcounter,error){
                        alert('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                alert('Error:'+error.code+" "+error.message);
            }
        });
}
$(function(){
        var Counter=AV.Object.extend("Counter");
        //only increse visit counting when intering a page
        if ($('.article-title').length == 1)
           addCount(Counter);
        var query=new AV.Query(Counter);
        query.descending("time");
        // the sum of popular posts
        query.limit(10); 
        query.find({
            success: function(results){
                    for(var i=0;i<results.length;i++)    
                    {
                        var counter=results[i];
                        title=counter.get("title");
                        url=counter.get("url");
                        time=counter.get("time");
                        // add to the popularlist widget
                        showcontent=title+" ("+time+")";
                        //notice the "" in href
                        $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                    }
                },
            error: function(error){
                alert("Error:"+error.code+" "+error.message);
            }
            }
        )
        });
</script>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017 
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>
<script src="/assets/highlight.pack.js?rev=@@hash"></script>
  <script>
    hljs.initHighlightingOnLoad(); //初始化代码高亮 
  </script>

<script src="/js/app.js?rev=@@hash"></script>
</body>
