<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="向志洪">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://www.xiangzhihong.com">
    <!--SEO-->





<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>Android滤镜效果实现及原理分析 | 向志洪</title>


    <link rel="alternate" href="/atom.xml" title="向志洪" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    <div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>
    
</head></html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header" style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner2.jpg)">
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="">
            <img src="/img/avatar.jpg" alt="logo头像">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题">  
             
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation"><a href="/"><i class="fa fa-fw fa-home"></i>首页</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/前端/"><i class="fa fa-fw"></i>前端</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/后端/"><i class="fa fa-fw"></i>后端</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/Java/"><i class="fa fa-fw"></i>Java</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/Python/"><i class="fa fa-fw"></i>Python</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/Android/"><i class="fa fa-fw"></i>Android</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/iOS/"><i class="fa fa-fw"></i>iOS</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/React Native/"><i class="fa fa-fw"></i>React Native</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/小程序/"><i class="fa fa-fw"></i>小程序</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/杂谈/"><i class="fa fa-fw"></i>杂谈</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Android滤镜效果实现及原理分析">
            
	            Android滤镜效果实现及原理分析
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/Android">
            Android
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a href="/tags/Android">
               Android
            </a>
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2016/10/27</span>
    </span>
	
	<span id="busuanzi_container_page_pv"> 阅读量<span id="busuanzi_value_page_pv"></span>次</span>
</div>
            
            
            <p class="fa fa-exclamation-triangle warning">
                本文于<strong>505</strong>天之前发表，文中内容可能已经过时。
            </p>
        
    </div>
    
    <div class="post-body post-content">
        <p>Android在处理图片时，最常使用到的数据结构是位图（Bitmap），它包含了一张图片所有的数据。整个图片都是由点阵和颜色值组成的，所谓点阵就是一个包含像素的矩阵，每一个元素对应着图片的一个像素。而颜色值——ARGB，分别对应着透明度、红、绿、蓝这四个通道分量，他们共同决定了每个像素点显示的颜色。下图是ARGB的模型图。<br><img src="http://img.blog.csdn.net/20180120105527576" alt="这里写图片描述"></p>
<h1 id="色彩矩阵分析"><a href="#色彩矩阵分析" class="headerlink" title="色彩矩阵分析"></a>色彩矩阵分析</h1><p>在Android中，系统使用一个颜色矩阵-ColorMatrix来处理图像的色彩效果。对于图像的每个像素点，都有一个颜色分量矩阵用来保存颜色的RGBA值（下图矩阵C），Android中的颜色矩阵是一个 4x5 的数字矩阵，它用来对图片的色彩进行处理（下图矩阵A）。<br><img src="http://img.blog.csdn.net/20180120105708036" alt="这里写图片描述"><br>在Android系统中，如果想要改变一张图像的色彩显示效果，可以使用矩阵的乘法运算来修改颜色分量矩阵的值。上面矩阵A就是一个 4x5 的颜色矩阵。在Android中，它会以一维数组的形式来存储[a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t]，而C则是一个颜色矩阵分量。在处理图像时，使用矩阵乘法运算AC来处理颜色分量矩阵，如下：<br><img src="http://img.blog.csdn.net/20180120105844225" alt="这里写图片描述"><br>利用线性代数知识可以得到如下等式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">R1 = aR + bG + cB + dA + e;</div><div class="line">G1 = fR + gG + hB + iA + j;</div><div class="line">B1 = kR + lG + mB + nA + o;</div><div class="line">A1 = pR + qG + rB + sA + t;</div></pre></td></tr></table></figure>
<p>从上面的等式可以发现：</p>
<ul>
<li>第一行的 abcde 用来决定新的颜色值中的R——红色</li>
<li>第二行的 fghij 用来决定新的颜色值中的G——绿色</li>
<li>第三行的 klmno 用来决定新的颜色值中的B——蓝色</li>
<li>第四行的 pqrst 用来决定新的颜色值中的A——透明度</li>
<li>矩阵A中第五列——ejot 值分别用来决定每个分量中的 offset ，即偏移量<br>这样一说明，大家对这个公司就明白了。</li>
</ul>
<h2 id="初始颜色矩阵"><a href="#初始颜色矩阵" class="headerlink" title="初始颜色矩阵"></a>初始颜色矩阵</h2><p>接下来，我们重新看一下矩阵变换的计算公式，以R分量为例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">R1 = aR + bG + cB + dA + e;</div></pre></td></tr></table></figure>
<p>如果令 a=1，b、c、d、e都等于0，则有 R1=R 。同理对第二、三、四、行进行操作，可以构造出一个矩阵，如下：<br><img src="http://img.blog.csdn.net/20180120110323581" alt="这里写图片描述"><br>把这个矩阵代入公式 R=AC，根据矩阵乘法运算法则，可得R1=R，G1=G，B1=B，A1=A。即不会对原有颜色进行任何修改，所以这个矩阵通常被用来作为初始颜色矩阵。</p>
<h3 id="改变颜色值"><a href="#改变颜色值" class="headerlink" title="改变颜色值"></a>改变颜色值</h3><p>如果想要改变颜色值的时候，通常有两种方法：</p>
<ul>
<li>改变颜色的 offset（偏移量）的值；</li>
<li>改变对应 RGBA 值的系数。</li>
</ul>
<h4 id="1-改变偏移量"><a href="#1-改变偏移量" class="headerlink" title="1.改变偏移量"></a>1.改变偏移量</h4><p>从前面的分析中可知，改变颜色的偏移量就是改变颜色矩阵的第五列的值，其他保持初始矩阵的值即可。如下示例：<br><img src="http://img.blog.csdn.net/20180120110529031" alt="这里写图片描述"><br>上面的操作中改变了 R、G 对应的颜色偏移量，那么结果就是图像的红色和绿色分量增加了100，即整体色调偏黄显示。<br><img src="http://img.blog.csdn.net/20180120110656583" alt="这里写图片描述"><br>其中，左边为原图，右边为改变 偏移量后的效果。</p>
<h4 id="2-改变颜色系数"><a href="#2-改变颜色系数" class="headerlink" title="2.改变颜色系数"></a>2.改变颜色系数</h4><p>假如我们队颜色矩阵做如下操作。<br><img src="http://img.blog.csdn.net/20180120110837961" alt="这里写图片描述"><br>改变 G 分量对应的系数 g 的值，增加到2倍，这样在矩阵运算后，图像会整体色调偏绿显示。<br><img src="http://img.blog.csdn.net/20180120110930163" alt="这里写图片描述"></p>
<p>通过前面的分析，我们知道调整颜色矩阵可以改变图像的色彩效果，图像的色彩处理很大程度上就是在寻找处理图像的颜色矩阵。</p>
<h3 id="Android实例"><a href="#Android实例" class="headerlink" title="Android实例"></a>Android实例</h3><p>下面，我们着手写一个demo，模拟一个 4x5 的颜色矩阵来体验一下上面对颜色矩阵的分析。效果如下：<br><img src="http://img.blog.csdn.net/20180120111038410" alt="这里写图片描述"></p>
<p>关键代码是将 4x5 矩阵转换成一维数组，然后再将这一维数组设置到ColorMatrix类里去，请看代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//将矩阵设置到图像</div><div class="line">    private void setImageMatrix() &#123;</div><div class="line">        Bitmap bmp = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        ColorMatrix colorMatrix = new ColorMatrix();</div><div class="line">        colorMatrix.set(mColorMatrix);//将一维数组设置到ColorMatrix</div><div class="line"></div><div class="line">        Canvas canvas = new Canvas(bmp);</div><div class="line">        Paint paint = new Paint();</div><div class="line">        paint.setColorFilter(new ColorMatrixColorFilter(colorMatrix));</div><div class="line">        canvas.drawBitmap(bitmap, 0, 0, paint);</div><div class="line">        iv_photo.setImageBitmap(bmp);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>这个demo里面的代码比较简单，我在这里就全部贴出来了，先上xml布局：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    tools:context=&quot;com.example.deeson.mycolormatrix.MainActivity&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/iv_photo&quot;</div><div class="line">        android:layout_width=&quot;300dp&quot;</div><div class="line">        android:layout_height=&quot;0dp&quot;</div><div class="line">        android:layout_weight=&quot;3&quot;</div><div class="line">        android:layout_gravity=&quot;center_horizontal&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;GridLayout</div><div class="line">        android:id=&quot;@+id/matrix_layout&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;0dp&quot;</div><div class="line">        android:layout_weight=&quot;4&quot;</div><div class="line">        android:columnCount=&quot;5&quot;</div><div class="line">        android:rowCount=&quot;4&quot;&gt;</div><div class="line"></div><div class="line">    &lt;/GridLayout&gt;</div><div class="line"></div><div class="line">    &lt;LinearLayout</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:orientation=&quot;horizontal&quot;&gt;</div><div class="line"></div><div class="line">        &lt;Button</div><div class="line">            android:id=&quot;@+id/btn_change&quot;</div><div class="line">            android:layout_width=&quot;0dp&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:layout_weight=&quot;1&quot;</div><div class="line">            android:text=&quot;change&quot;/&gt;</div><div class="line">        &lt;Button</div><div class="line">            android:id=&quot;@+id/btn_reset&quot;</div><div class="line">            android:layout_width=&quot;0dp&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:layout_weight=&quot;1&quot;</div><div class="line">            android:text=&quot;reset&quot;/&gt;</div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>在 MainActivity 类这里有一个地方要注意的就是，我们无法在 onCreate() 方法中获得 4x5 矩阵视图的宽高值，所以通过 View 的 post() 方法，在视图创建完毕后获得其宽高值。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">matrixLayout.post(new Runnable() &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        mEtWidth = matrixLayout.getWidth() / 5;</div><div class="line">        mEtHeight = matrixLayout.getHeight() / 4;</div><div class="line">        addEts();</div><div class="line">        initMatrix();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>接下来是 MainActivity 类的全部代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity implements View.OnClickListener &#123;</div><div class="line"></div><div class="line">    Bitmap bitmap;</div><div class="line">    ImageView iv_photo;</div><div class="line">    GridLayout matrixLayout;</div><div class="line">    //每个edittext的宽高</div><div class="line">    int mEtWidth;</div><div class="line">    int mEtHeight;</div><div class="line">    //保存20个edittext</div><div class="line">    EditText[] mEts = new EditText[20];</div><div class="line"></div><div class="line">    //一维数组保存20个矩阵值</div><div class="line">    float[] mColorMatrix = new float[20];</div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.iv_model);</div><div class="line">        iv_photo = (ImageView) findViewById(R.id.iv_photo);</div><div class="line">        matrixLayout = (GridLayout) findViewById(R.id.matrix_layout);</div><div class="line">        Button btn_change = (Button) findViewById(R.id.btn_change);</div><div class="line">        Button btn_reset = (Button) findViewById(R.id.btn_reset);</div><div class="line">        btn_change.setOnClickListener(this);</div><div class="line">        btn_reset.setOnClickListener(this);</div><div class="line">        iv_photo.setImageBitmap(bitmap);</div><div class="line"></div><div class="line">        //我们无法在onCreate()方法中获得视图的宽高值，所以通过View的post()方法，在视图创建完毕后获得其宽高值</div><div class="line">        matrixLayout.post(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                mEtWidth = matrixLayout.getWidth() / 5;</div><div class="line">                mEtHeight = matrixLayout.getHeight() / 4;</div><div class="line">                addEts();</div><div class="line">                initMatrix();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //动态添加edittext</div><div class="line">    private void addEts() &#123;</div><div class="line">        for (int i = 0; i &lt; 20; i++) &#123;</div><div class="line">            EditText et = new EditText(this);</div><div class="line">            et.setInputType(InputType.TYPE_CLASS_NUMBER | InputType.TYPE_NUMBER_FLAG_DECIMAL);</div><div class="line">            mEts[i] = et;</div><div class="line">            matrixLayout.addView(et, mEtWidth, mEtHeight);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //初始化颜色矩阵</div><div class="line">    private void initMatrix() &#123;</div><div class="line">        for (int i = 0; i &lt; 20; i++) &#123;</div><div class="line">            if (i % 6 == 0) &#123;</div><div class="line">                mEts[i].setText(String.valueOf(1));</div><div class="line">            &#125; else &#123;</div><div class="line">                mEts[i].setText(String.valueOf(0));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    //获取矩阵值</div><div class="line">    private void getMatrix() &#123;</div><div class="line">        for (int i = 0; i &lt; 20; i++) &#123;</div><div class="line">            String matrix = mEts[i].getText().toString();</div><div class="line">            boolean isNone = null == matrix || &quot;&quot;.equals(matrix);</div><div class="line">            mColorMatrix[i] = isNone ? 0.0f : Float.valueOf(matrix);</div><div class="line">            if (isNone) &#123;</div><div class="line">                mEts[i].setText(&quot;0&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //将矩阵设置到图像</div><div class="line">    private void setImageMatrix() &#123;</div><div class="line">        Bitmap bmp = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        ColorMatrix colorMatrix = new ColorMatrix();</div><div class="line">        colorMatrix.set(mColorMatrix);//将一维数组设置到ColorMatrix</div><div class="line"></div><div class="line">        Canvas canvas = new Canvas(bmp);</div><div class="line">        Paint paint = new Paint();</div><div class="line">        paint.setColorFilter(new ColorMatrixColorFilter(colorMatrix));</div><div class="line">        canvas.drawBitmap(bitmap, 0, 0, paint);</div><div class="line">        iv_photo.setImageBitmap(bmp);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onClick(View v) &#123;</div><div class="line">        switch (v.getId()) &#123;</div><div class="line">            case R.id.btn_change:</div><div class="line">                //作用矩阵效果</div><div class="line">                break;</div><div class="line">            case R.id.btn_reset:</div><div class="line">                //重置矩阵效果</div><div class="line">                initMatrix();</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        //作用矩阵效果</div><div class="line">        getMatrix();</div><div class="line">        setImageMatrix();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果有人不想自己敲代码的，可以到下面地址下载：<a href="https://github.com/DeesonWoo/MyColorMatrixDemo" target="_blank" rel="external">Demo下载地址</a></p>
<h1 id="图像的色光属性"><a href="#图像的色光属性" class="headerlink" title="图像的色光属性"></a>图像的色光属性</h1><p>在色彩处理中，通常使用以下三个角度来描述一个图像。</p>
<ul>
<li>色调：物体传播的颜色</li>
<li>饱和度：颜色的纯度，从0（灰）到100%（饱和）来进行描述</li>
<li>亮度：颜色的相对明暗程度<br>在Android 的 ColorMatrix 颜色矩阵中也封装了一些 API 来快速调整上面这三个颜色参数，而不用每次都去计算矩阵的值。详情可参考这个文档 ：<a href="https://developer.android.com/reference/android/graphics/ColorMatrix.html" target="_blank" rel="external">https://developer.android.com/reference/android/graphics/ColorMatrix.html</a></li>
</ul>
<h3 id="色调"><a href="#色调" class="headerlink" title="色调"></a>色调</h3><p>Android系统提供了 setRotate(int axis, float degrees)方法来修改颜色的色调。第一个参数，用0、1、2分别代表红、绿、蓝三个颜色通道，第二个参数就是要修改的值，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ColorMatrix hueMatrix = new ColorMatrix();</div><div class="line">hueMatrix.setRotate(0,hue0);</div><div class="line">hueMatrix.setRotate(1,hue1);</div><div class="line">hueMatrix.setRotate(2,hue2);</div></pre></td></tr></table></figure>
<p>Android系统的 setRotate(int axis, float degrees) 方法其实就是对色彩的旋转运算。RGB色是如何旋转的呢，首先用R、G、B三色建立三维坐标系，如下：<br><img src="http://img.blog.csdn.net/20180120111850634" alt="这里写图片描述"></p>
<p>这里，我们把一个色彩值看成三维空间里的一个点，色彩值的三个分量可以看成该点对应的坐标（三维坐标）。先不考虑在三个维度综合情况下是怎么旋转的，我们先看看在某个轴做为Z轴，在另两个轴形成的平面上旋转的情况。假如，我们现在需要围绕蓝色轴进行旋转，我们对着蓝色箭头观察由红色和绿色构造的平面。然后顺时针旋转 α 度。 如下图所示：<br><img src="http://img.blog.csdn.net/20180120112019592" alt="这里写图片描述"></p>
<p>在图中，我们可以看到，在旋转后，原 R 在 R 轴的分量变为：R<em>cosα，且原G分量在旋转后在 R 轴上也有了分量，所以我们要加上这部分分量，因此最终的结果为 R’=R</em>cosα + G<em>sinα，同理，在计算 G’ 时，因为 R 的分量落在了负轴上，所以我们要减去这部分，故 G’=G</em>cosα - R*sinα；<br>回忆之前讲过的矩阵乘法运算法则，下图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">R1 = aR + bG + cB + dA + e;</div><div class="line">G1 = fR + gG + hB + iA + j;</div><div class="line">B1 = kR + lG + mB + nA + o;</div><div class="line">A1 = pR + qG + rB + sA + t;</div></pre></td></tr></table></figure>
<p>可以计算出围绕蓝色分量轴顺时针旋转 α 度的颜色矩阵如下：<br><img src="http://img.blog.csdn.net/20180120112150582" alt="这里写图片描述"><br>同理，可以得出围绕红色分量轴顺时针旋转 α 度的颜色矩阵：<br><img src="http://img.blog.csdn.net/20180120112227243" alt="这里写图片描述"><br>围绕绿色分量轴顺时针旋转 α 度的颜色矩阵：<br><img src="http://img.blog.csdn.net/20180120112305383" alt="这里写图片描述"></p>
<p>通过上面的分析，我们可以知道，当围绕红色分量轴进行色彩旋转时，由于当前红色分量轴的色彩是不变的，而仅利用三角函数来动态的变更绿色和蓝色的颜色值。这种改变就叫做色相调节。</p>
<p>当围绕红色分量轴旋转时，是对图片就行红色色相的调节；同理，当围绕蓝色分量轴旋转时，就是对图片就行蓝色色相调节；当然，当围绕绿色分量轴旋转时，就是对图片进行绿色色相的调节。</p>
<p>下面是Android系统对色调修改的源码，我们可以看得到，源码对第二个参数进行转换成弧度，即对红、绿、蓝三个颜色通道分别进行旋转，那我们在第二个参数中传入我们平时用的度数即可。通过对源码的阅读，我们也知道，第二个参数最终被设置的数值范围为 [-1,1] ，然后再设置到颜色矩阵中。即我们在第二个参数传入[-180，180]范围的值（一个最小周期）即可。</p>
<p>下面是上面理论设计到的相关系统源码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">public void setRotate(int axis, float degrees) &#123;</div><div class="line">        reset();</div><div class="line">        double radians = degrees * Math.PI / 180d;</div><div class="line">        float cosine = (float) Math.cos(radians);</div><div class="line">        float sine = (float) Math.sin(radians);</div><div class="line">        switch (axis) &#123;</div><div class="line">        // Rotation around the red color</div><div class="line">        case 0:</div><div class="line">            mArray[6] = mArray[12] = cosine;</div><div class="line">            mArray[7] = sine;</div><div class="line">            mArray[11] = -sine;</div><div class="line">            break;</div><div class="line">        // Rotation around the green color</div><div class="line">        case 1:</div><div class="line">            mArray[0] = mArray[12] = cosine;</div><div class="line">            mArray[2] = -sine;</div><div class="line">            mArray[10] = sine;</div><div class="line">            break;</div><div class="line">        // Rotation around the blue color</div><div class="line">        case 2:</div><div class="line">            mArray[0] = mArray[6] = cosine;</div><div class="line">            mArray[1] = sine;</div><div class="line">            mArray[5] = -sine;</div><div class="line">            break;</div><div class="line">        default:</div><div class="line">            throw new RuntimeException();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="饱和度"><a href="#饱和度" class="headerlink" title="饱和度"></a>饱和度</h3><p>Android系统提供了 setSaturation(float sat) 方法来修改颜色的饱和度。参数 float sat：表示把当前色彩饱和度放大的倍数。取值为0表示完全无色彩，即灰度图像（黑白图像）；取值为1时，表示色彩不变动；当取值大于1时，显示色彩过度饱和 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ColorMatrix saturationMatrix = new ColorMatrix();</div><div class="line">saturationMatrix.setSaturation(saturation);</div></pre></td></tr></table></figure>
<p>同样贴出修改饱和度值的源码，通过源码我们可以看到系统是通过改变颜色矩阵中对角线上系数的比例来改变饱和度。系统相关源码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public void setSaturation(float sat) &#123;</div><div class="line">        reset();</div><div class="line">        float[] m = mArray;</div><div class="line"></div><div class="line">        final float invSat = 1 - sat;</div><div class="line">        final float R = 0.213f * invSat;</div><div class="line">        final float G = 0.715f * invSat;</div><div class="line">        final float B = 0.072f * invSat;</div><div class="line"></div><div class="line">        m[0] = R + sat; m[1] = G;       m[2] = B;</div><div class="line">        m[5] = R;       m[6] = G + sat; m[7] = B;</div><div class="line">        m[10] = R;      m[11] = G;      m[12] = B + sat;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="亮度"><a href="#亮度" class="headerlink" title="亮度"></a>亮度</h3><p>当三原色以相同比例进行混合时，就会显示出白色。Android系统正是利用这个原理对图像进行亮度的改变。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ColorMatrix lumMatrix = new ColorMatrix();</div><div class="line">lumMatrix.setScale(lum,lum,lum,1);</div></pre></td></tr></table></figure>
<p>同样贴出修改亮度值的源码，当亮度为 0 时，图像就变成全黑了。通过对源码的阅读，我们可以知道， 系统将颜色矩阵置为初始初始颜色矩阵，再将红、绿、蓝、透明度四个分量通道对应的系数修改成我们传入的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public void setScale(float rScale, float gScale, float bScale,</div><div class="line">                         float aScale) &#123;</div><div class="line">        final float[] a = mArray;</div><div class="line"></div><div class="line">        for (int i = 19; i &gt; 0; --i) &#123;</div><div class="line">            a[i] = 0;</div><div class="line">        &#125;</div><div class="line">        a[0] = rScale;</div><div class="line">        a[6] = gScale;</div><div class="line">        a[12] = bScale;</div><div class="line">        a[18] = aScale;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>当然，除了单独使用上面的三种方法来进行颜色效果的处理之外，Android系统还封装了矩阵的乘法运算。它提供了 postConcat(ColorMatrix postmatrix) 方法来将矩阵的作用效果混合，从而叠加处理效果。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ColorMatrix imageMatrix = new ColorMatrix();</div><div class="line">imageMatrix.postConcat(hueMatrix);</div><div class="line">imageMatrix.postConcat(saturationMatrix);</div><div class="line">imageMatrix.postConcat(lumMatrix);</div></pre></td></tr></table></figure>
<h2 id="Android实例-1"><a href="#Android实例-1" class="headerlink" title="Android实例"></a>Android实例</h2><p>下面，通过一个demo来给大家看看，修改色调、饱和度、亮度的效果。<br>首先我们看看效果图，如下：<br><img src="http://img.blog.csdn.net/20180120112848500" alt="这里写图片描述"></p>
<p>这里的 demo 通过滑动三个 SeekBar 来改变不同的值，并将这些数值作用到对应色调、饱和度、亮度的颜色矩阵中，最后通过 ColorMatrix 的 postConcat() 方法来混合这三个被修改的颜色矩阵的显示效果。相关代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public static Bitmap handleImageEffect(Bitmap oriBmp, Bitmap bmp, float hue, float saturation, float lum) &#123;</div><div class="line">        Canvas canvas = new Canvas(bmp);</div><div class="line">        Paint paint = new Paint();</div><div class="line"></div><div class="line">        ColorMatrix hueMatrix = new ColorMatrix();</div><div class="line">        hueMatrix.setRotate(0, hue);</div><div class="line">        hueMatrix.setRotate(1, hue);</div><div class="line">        hueMatrix.setRotate(2, hue);</div><div class="line"></div><div class="line">        ColorMatrix saturationMatrix = new ColorMatrix();</div><div class="line">        saturationMatrix.setSaturation(saturation);</div><div class="line"></div><div class="line">        ColorMatrix lumMatrix = new ColorMatrix();</div><div class="line">        lumMatrix.setScale(lum, lum, lum, 1);</div><div class="line"></div><div class="line">        ColorMatrix imageMatrix = new ColorMatrix();</div><div class="line">        imageMatrix.postConcat(hueMatrix);</div><div class="line">        imageMatrix.postConcat(saturationMatrix);</div><div class="line">        imageMatrix.postConcat(lumMatrix);</div><div class="line"></div><div class="line">        paint.setColorFilter(new ColorMatrixColorFilter(imageMatrix));</div><div class="line">        canvas.drawBitmap(oriBmp, 0, 0, paint);</div><div class="line"></div><div class="line">        return bmp;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>Android系统不允许直接修改原图，类似 Photoshop 中的锁定，必须通过原图创建一个同样大小的 Bitmap ，并将原图绘制到该 Bitmap 中，以一个副本的形式来修改图像。<br>在设置好需要处理的颜色矩阵后，通过使用 Paint 类的 setColorFilter() 方法，将通过 imageMatrix 构造的 ColorMatrixColorFilter 对象传递进去，并使用这个画笔来绘制原来的图像，从而将颜色矩阵作用到图像中。<br>下面是布局文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    tools:context=&quot;com.example.deeson.mycolor.MainActivity&quot;</div><div class="line">    android:orientation=&quot;vertical&quot;&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/iv_photo&quot;</div><div class="line">        android:layout_width=&quot;300dp&quot;</div><div class="line">        android:layout_height=&quot;300dp&quot;</div><div class="line">        android:layout_gravity=&quot;center_horizontal&quot;</div><div class="line">        android:layout_marginTop=&quot;20dp&quot;</div><div class="line">        android:src=&quot;@drawable/iv_model0&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_marginTop=&quot;20dp&quot;</div><div class="line">        android:layout_marginLeft=&quot;5dp&quot;</div><div class="line">        android:textColor=&quot;@android:color/black&quot;</div><div class="line">        android:text=&quot;色调&quot;</div><div class="line">        /&gt;</div><div class="line">    &lt;SeekBar</div><div class="line">        android:id=&quot;@+id/seekbarHue&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:max=&quot;200&quot;</div><div class="line">        android:progress=&quot;100&quot;/&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_marginTop=&quot;10dp&quot;</div><div class="line">        android:layout_marginLeft=&quot;5dp&quot;</div><div class="line">        android:textColor=&quot;@android:color/black&quot;</div><div class="line">        android:text=&quot;饱和度&quot;</div><div class="line">        /&gt;</div><div class="line">    &lt;SeekBar</div><div class="line">        android:id=&quot;@+id/seekbarSaturation&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:max=&quot;200&quot;</div><div class="line">        android:progress=&quot;100&quot;/&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;wrap_content&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_marginTop=&quot;10dp&quot;</div><div class="line">        android:layout_marginLeft=&quot;5dp&quot;</div><div class="line">        android:textColor=&quot;@android:color/black&quot;</div><div class="line">        android:text=&quot;亮度&quot;</div><div class="line">        /&gt;</div><div class="line">    &lt;SeekBar</div><div class="line">        android:id=&quot;@+id/seekbarLum&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:max=&quot;200&quot;</div><div class="line">        android:progress=&quot;100&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>然后是 MainActivity 类的代码，就是获取三个 SeekBar 的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity implements SeekBar.OnSeekBarChangeListener &#123;</div><div class="line"></div><div class="line">    ImageView iv_photo;</div><div class="line">    float mHue = 0.0f;</div><div class="line">    float mSaturation = 1f;</div><div class="line">    float mLum = 1f;</div><div class="line">    float MID_VALUE;</div><div class="line">    Bitmap oriBitmap,newBitmap;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        iv_photo = (ImageView) findViewById(R.id.iv_photo);</div><div class="line">        SeekBar barHue = (SeekBar) findViewById(R.id.seekbarHue);</div><div class="line">        SeekBar barSaturation = (SeekBar) findViewById(R.id.seekbarSaturation);</div><div class="line">        SeekBar barLum = (SeekBar) findViewById(R.id.seekbarLum);</div><div class="line">        MID_VALUE = barHue.getMax() * 1.0F / 2;</div><div class="line">        oriBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.iv_model0);</div><div class="line">        //Android系统不允许直接修改原图</div><div class="line">        newBitmap = Bitmap.createBitmap(oriBitmap.getWidth(), oriBitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        barHue.setOnSeekBarChangeListener(this);</div><div class="line">        barSaturation.setOnSeekBarChangeListener(this);</div><div class="line">        barLum.setOnSeekBarChangeListener(this);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) &#123;</div><div class="line">        switch (seekBar.getId()) &#123;</div><div class="line">            case R.id.seekbarHue:</div><div class="line">                mHue = (progress - MID_VALUE) * 1.0F / MID_VALUE * 180;</div><div class="line">                break;</div><div class="line">            case R.id.seekbarSaturation:</div><div class="line">                mSaturation = progress * 1.0F / MID_VALUE;</div><div class="line">                break;</div><div class="line">            case R.id.seekbarLum:</div><div class="line">                mLum = progress * 1.0F / MID_VALUE;</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">        iv_photo.setImageBitmap(ImageHelper.handleImageEffect(oriBitmap,newBitmap, mHue, mSaturation, mLum));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onStartTrackingTouch(SeekBar seekBar) &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onStopTrackingTouch(SeekBar seekBar) &#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/DeesonWoo/MyColorDemo" target="_blank" rel="external">代码Demo</a><br>其实讲到这里，大家对颜色矩阵和滤镜的实现原理有一个大概的了解了吧。</p>
<h2 id="常用颜色矩阵"><a href="#常用颜色矩阵" class="headerlink" title="常用颜色矩阵"></a>常用颜色矩阵</h2><h3 id="灰度效果"><a href="#灰度效果" class="headerlink" title="灰度效果"></a>灰度效果</h3><p><img src="http://img.blog.csdn.net/20180120113258188" alt="这里写图片描述"></p>
<h3 id="图像反转"><a href="#图像反转" class="headerlink" title="图像反转"></a>图像反转</h3><p><img src="http://img.blog.csdn.net/20180120113356292" alt="这里写图片描述"></p>
<p>效果如下：<br><img src="http://img.blog.csdn.net/20180120114228869" alt="这里写图片描述"></p>
<h3 id="怀旧效果"><a href="#怀旧效果" class="headerlink" title="怀旧效果"></a>怀旧效果</h3><p><img src="http://img.blog.csdn.net/20180120113715106" alt="这里写图片描述"><br>效果如下：<br><img src="http://img.blog.csdn.net/20180120114254448" alt="这里写图片描述"></p>
<h3 id="去色效果"><a href="#去色效果" class="headerlink" title="去色效果"></a>去色效果</h3><p><img src="http://img.blog.csdn.net/20180120114336995" alt="这里写图片描述"><br>效果如下：</p>
<p><img src="http://img.blog.csdn.net/20180120114114484" alt="这里写图片描述"></p>
<h3 id="高饱和度"><a href="#高饱和度" class="headerlink" title="高饱和度"></a>高饱和度</h3><p><img src="http://img.blog.csdn.net/20180120114414458" alt="这里写图片描述"><br>效果如下：<br><img src="http://img.blog.csdn.net/20180120114444769" alt="这里写图片描述"></p>
<h3 id="色彩反色"><a href="#色彩反色" class="headerlink" title="色彩反色"></a>色彩反色</h3><p>这里是红绿反色，另外红蓝、蓝绿反色原理一样，就是把颜色初始矩阵中对应颜色通道的值交换处理，如下：<br><img src="http://img.blog.csdn.net/20180120114531694" alt="这里写图片描述"></p>
<h2 id="GPUImage滤镜"><a href="#GPUImage滤镜" class="headerlink" title="GPUImage滤镜"></a>GPUImage滤镜</h2><p>GPUImage是一个专门做滤镜和帖纸的开源库，详细资料就不介绍了，给大家提供一个我开源的使用例子。<br><img src="http://img.blog.csdn.net/20180120114851276" alt="这里写图片描述"></p>
<p>项目源码：<a href="https://github.com/xiangzhihong/gpuImage" target="_blank" rel="external">https://github.com/xiangzhihong/gpuImage</a></p>
    </div>

    <div class="post-footer">   
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
        </div>
        <div>
            
        </div>  
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2016/10/28/React 页面渲染原理/" class="pre-post btn btn-default"><i class="fa fa-angle-left fa-fw"></i>上一篇</a>
    
    
        <a href="/2016/10/20/React native城市列表组件/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        <!--PC和WAP自适应版-->
<div id="SOHUCS"></div>
<script type="text/javascript">
	(function(){var appid='cytettIQe';var conf='prod_5adcbaeeac53951692e9780989c7fed5';var width=window.innerWidth||document.documentElement.clientWidth;if(width<960){window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+appid+'&conf='+conf+'"><\/script>');}else{var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}
	c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})});}})();
</script>
    </div>
                </main>
                <aside class="col-md-4 sidebar">
        
        <div class="widget">    
        <h3 class="title">搜索</h3>
        <div id="search-form">
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?">
                    <button type="button" class="search-form-submit" id="search-local">站内搜索</button>
                
                
            </div>
            <div id="result-wrap" class="hide">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>
        
        <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>主题Snippet v1.2.0版本已经上线！欢迎更新~ <br>
主题下载：<a href="https://github.com/shenliyang/hexo-theme-snippet" title="fork me" target="_blank">Snippet主题</a> <br>
<hr>接受贡献，包括不限于提交问题与需求，修复代码。欢迎Pull Request<br>支持主题：<a href="https://github.com/shenliyang/hexo-theme-snippet/stargazers">Star一下</a>
</p>
        </div>
    </div>
        
        <div class="widget">
      <h3 class="title">社交</h3> 
        <div class="content social">
            
	            <a href="//github.com/shenliyang" rel="external nofollow" title="Github" target="_blank">
			    	<i class="git fa fa-git"></i>
			    </a>
            
	            <a href="mailto:snippet@91h5.cc" rel="external nofollow" title="邮箱" target="_blank">
			    	<i class="envelope-o fa fa-envelope-o"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="联系QQ" target="_blank">
			    	<i class="qq fa fa-qq"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="微博" target="_blank">
			    	<i class="weibo fa fa-weibo"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="QQ群" target="_blank">
			    	<i class="users fa fa-users"></i>
			    </a>
            
	            <a href="/atom.xml" rel="external nofollow" title="RSS" target="_blank">
			    	<i class="feed fa fa-feed"></i>
			    </a>
            
        </div>
    </div>
        
        <div class="widget">
        <h3 class="title">分类</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/"><i class="fa" aria-hidden="true">Android</i></a><span class="category-list-count">41</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/系统/"><i class="fa" aria-hidden="true">系统</i></a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google/"><i class="fa" aria-hidden="true">Google</i></a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Google/VR/"><i class="fa" aria-hidden="true">VR</i></a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/"><i class="fa" aria-hidden="true">Java</i></a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/"><i class="fa" aria-hidden="true">Kotlin</i></a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PWA/"><i class="fa" aria-hidden="true">PWA</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/"><i class="fa" aria-hidden="true">Python</i></a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React-Native/"><i class="fa" aria-hidden="true">React Native</i></a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/"><i class="fa" aria-hidden="true">Spring</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/"><i class="fa" aria-hidden="true">android</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/"><i class="fa" aria-hidden="true">iOS</i></a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios/"><i class="fa" aria-hidden="true">ios</i></a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/"><i class="fa" aria-hidden="true">python</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人工智能/"><i class="fa" aria-hidden="true">人工智能</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/"><i class="fa" aria-hidden="true">前端</i></a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/区块链/"><i class="fa" aria-hidden="true">区块链</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/"><i class="fa" aria-hidden="true">后端</i></a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/小程序/"><i class="fa" aria-hidden="true">小程序</i></a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术人生/"><i class="fa" aria-hidden="true">技术人生</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/"><i class="fa" aria-hidden="true">机器学习</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/"><i class="fa" aria-hidden="true">杂谈</i></a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/"><i class="fa" aria-hidden="true">编程语言</i></a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/"><i class="fa" aria-hidden="true">设计模式</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/资料库/"><i class="fa" aria-hidden="true">资料库</i></a><span class="category-list-count">1</span></li></ul>
    </div>
        
        <div class="widget">
      <h3 class="title">归档</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/"><i class="fa" aria-hidden="true">二月 2018</i></a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/"><i class="fa" aria-hidden="true">一月 2018</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/"><i class="fa" aria-hidden="true">十二月 2017</i></a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/"><i class="fa" aria-hidden="true">十一月 2017</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/"><i class="fa" aria-hidden="true">十月 2017</i></a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/"><i class="fa" aria-hidden="true">九月 2017</i></a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/"><i class="fa" aria-hidden="true">八月 2017</i></a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/"><i class="fa" aria-hidden="true">七月 2017</i></a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/"><i class="fa" aria-hidden="true">六月 2017</i></a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/"><i class="fa" aria-hidden="true">五月 2017</i></a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/"><i class="fa" aria-hidden="true">四月 2017</i></a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/"><i class="fa" aria-hidden="true">三月 2017</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/"><i class="fa" aria-hidden="true">二月 2017</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/"><i class="fa" aria-hidden="true">一月 2017</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/"><i class="fa" aria-hidden="true">十二月 2016</i></a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/"><i class="fa" aria-hidden="true">十一月 2016</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/"><i class="fa" aria-hidden="true">十月 2016</i></a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/"><i class="fa" aria-hidden="true">九月 2016</i></a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/"><i class="fa" aria-hidden="true">八月 2016</i></a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/"><i class="fa" aria-hidden="true">七月 2016</i></a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/"><i class="fa" aria-hidden="true">六月 2016</i></a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/"><i class="fa" aria-hidden="true">五月 2016</i></a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/"><i class="fa" aria-hidden="true">四月 2016</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/"><i class="fa" aria-hidden="true">三月 2016</i></a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/"><i class="fa" aria-hidden="true">二月 2016</i></a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/"><i class="fa" aria-hidden="true">一月 2016</i></a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/"><i class="fa" aria-hidden="true">九月 2015</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/"><i class="fa" aria-hidden="true">六月 2015</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/"><i class="fa" aria-hidden="true">五月 2015</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/"><i class="fa" aria-hidden="true">四月 2015</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/"><i class="fa" aria-hidden="true">三月 2015</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/"><i class="fa" aria-hidden="true">一月 2015</i></a><span class="archive-list-count">1</span></li></ul>
    </div>
        
        <div class="widget">
    <h3 class="title">标签云</h3>
    <div class="content tag-cloud">
        <a href="/tags/AR/" style="font-size: 10px">AR</a> <a href="/tags/Android/" style="font-size: 20px">Android</a> <a href="/tags/Angular2/" style="font-size: 10px">Angular2</a> <a href="/tags/FlexBox布局/" style="font-size: 10px">FlexBox布局</a> <a href="/tags/Google/" style="font-size: 10.77px">Google</a> <a href="/tags/Java/" style="font-size: 15.38px">Java</a> <a href="/tags/Kotlin/" style="font-size: 16.92px">Kotlin</a> <a href="/tags/Node/" style="font-size: 10.77px">Node</a> <a href="/tags/OpenGL/" style="font-size: 10px">OpenGL</a> <a href="/tags/PWA/" style="font-size: 10px">PWA</a> <a href="/tags/Promise/" style="font-size: 10px">Promise</a> <a href="/tags/Python/" style="font-size: 16.15px">Python</a> <a href="/tags/React-Native/" style="font-size: 18.46px">React Native</a> <a href="/tags/Spring/" style="font-size: 10.77px">Spring</a> <a href="/tags/Swift/" style="font-size: 10px">Swift</a> <a href="/tags/VR/" style="font-size: 10.77px">VR</a> <a href="/tags/Xcode/" style="font-size: 11.54px">Xcode</a> <a href="/tags/android/" style="font-size: 12.31px">android</a> <a href="/tags/eact-Native/" style="font-size: 10px">eact Native</a> <a href="/tags/gif/" style="font-size: 10px">gif</a> <a href="/tags/gulp/" style="font-size: 10px">gulp</a> <a href="/tags/https/" style="font-size: 10px">https</a> <a href="/tags/iOS/" style="font-size: 17.69px">iOS</a> <a href="/tags/ios/" style="font-size: 16.15px">ios</a> <a href="/tags/mac/" style="font-size: 10px">mac</a> <a href="/tags/react/" style="font-size: 10px">react</a> <a href="/tags/swift/" style="font-size: 10px">swift</a> <a href="/tags/webpack/" style="font-size: 10px">webpack</a> <a href="/tags/个人博客/" style="font-size: 10.77px">个人博客</a> <a href="/tags/人工智能/" style="font-size: 10px">人工智能</a> <a href="/tags/入门/" style="font-size: 10.77px">入门</a> <a href="/tags/全栈/" style="font-size: 10px">全栈</a> <a href="/tags/内存分配/" style="font-size: 10px">内存分配</a> <a href="/tags/前端/" style="font-size: 19.23px">前端</a> <a href="/tags/前端开发/" style="font-size: 11.54px">前端开发</a> <a href="/tags/区块链/" style="font-size: 10px">区块链</a> <a href="/tags/原理/" style="font-size: 10px">原理</a> <a href="/tags/原生/" style="font-size: 10px">原生</a> <a href="/tags/后端/" style="font-size: 14.62px">后端</a> <a href="/tags/垃圾回收/" style="font-size: 10px">垃圾回收</a> <a href="/tags/小程序/" style="font-size: 13.85px">小程序</a> <a href="/tags/微信/" style="font-size: 13.08px">微信</a> <a href="/tags/打包/" style="font-size: 10px">打包</a> <a href="/tags/搭建网站/" style="font-size: 10px">搭建网站</a> <a href="/tags/新特性/" style="font-size: 10.77px">新特性</a> <a href="/tags/机器学习/" style="font-size: 10.77px">机器学习</a> <a href="/tags/杂谈/" style="font-size: 14.62px">杂谈</a> <a href="/tags/流量/" style="font-size: 10px">流量</a> <a href="/tags/深入理解/" style="font-size: 10px">深入理解</a> <a href="/tags/深入系统/" style="font-size: 10px">深入系统</a> <a href="/tags/混淆打包/" style="font-size: 10px">混淆打包</a> <a href="/tags/环境/" style="font-size: 10px">环境</a> <a href="/tags/知识库/" style="font-size: 10.77px">知识库</a> <a href="/tags/硬件/" style="font-size: 10px">硬件</a> <a href="/tags/算法/" style="font-size: 10px">算法</a> <a href="/tags/系统服务/" style="font-size: 10px">系统服务</a> <a href="/tags/编程语言/" style="font-size: 10.77px">编程语言</a> <a href="/tags/设计模式/" style="font-size: 10px">设计模式</a> <a href="/tags/调试/" style="font-size: 10px">调试</a>
    </div>
  </div>
        
        <div class="widget">
        <h3 class="title">友链</h3>
        <div class="content friends-link">
        
            <a href="http://blog.csdn.net/xiangzhihong8/" class="fa" target="_blank">作者博客</a>
        
            <a href="https://yq.aliyun.com/u/xiangzhihong" class="fa" target="_blank">阿里云博客</a>
        
        </div>
    </div>
        
    </aside>
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="hide">
	<i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
			
			    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
                <span>Copyright &copy; 2017
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>

<script src="/js/search.js?rev=@@hash"></script>


<script src="/js/app.js?rev=@@hash"></script>
</body>
